let t=0;const s=Math.PI,i=t=>t<0?-t:t,e=(t,s)=>t<s?t:s,n=(t,s)=>t>s?t:s,h=t=>t<0?-1:1,r=(t,s=0,i=1)=>t<s?s:t>i?i:t,o=(t,s=0,i=1)=>i-s?r((t-s)/(i-s)):0,u=(t=1,s=0)=>s+(t-s)*Math.random();const c=(t=0,s)=>null==t.x?new a(t,s??t):new a(t.x,t.y);class a{constructor(t=0,s=0){this.x=t,this.y=s}t(){return new a(this.x,this.y)}add(t){return new a(this.x+t.x,this.y+t.y)}i(t){return new a(this.x-t.x,this.y-t.y)}multiply(t){return new a(this.x*t.x,this.y*t.y)}h(t){return new a(this.x/t.x,this.y/t.y)}scale(t){return new a(this.x*t,this.y*t)}length(){return this.o()**.5}o(){return this.x**2+this.y**2}u(t){return this.l(t)**.5}l(t){return(this.x-t.x)**2+(this.y-t.y)**2}normalize(t=1){const s=this.length();return s?this.scale(t/s):new a(0,t)}p(t=1){const s=this.length();return s>t?this.scale(t/s):this}m(t){return this.x*t.x+this.y*t.y}g(t){return this.x*t.y-this.y*t.x}angle(){return Math.atan2(this.x,this.y)}v(t=0,s=1){return this.x=s*Math.sin(t),this.y=s*Math.cos(t),this}rotate(t){const s=Math.cos(t),i=Math.sin(t);return new a(this.x*s-this.y*i,this.x*i+this.y*s)}direction(){return i(this.x)>i(this.y)?this.x<0?3:1:this.y<0?2:0}M(){return new a(this.y,-this.x)}floor(){return new a(Math.floor(this.x),Math.floor(this.y))}A(){return i(this.x*this.y)}k(t,s){return this.add(t.i(this).scale(r(s)))}T(t){return this.x>=0&&this.y>=0&&this.x<t.x&&this.y<t.y}toString(){return`(${(this.x<0?"":" ")+this.x.toFixed(0)},${(this.y<0?"":" ")+this.y.toFixed(0)} )`}}class l{constructor(t=1,s=1,i=1,e=1){this.r=t,this.C=s,this.b=i,this.a=e}t(){return new l(this.r,this.C,this.b,this.a)}add(t){return new l(this.r+t.r,this.C+t.C,this.b+t.b,this.a+t.a)}i(t){return new l(this.r-t.r,this.C-t.C,this.b-t.b,this.a-t.a)}multiply(t){return new l(this.r*t.r,this.C*t.C,this.b*t.b,this.a*t.a)}scale(t,s=t){return new l(this.r*t,this.C*t,this.b*t,this.a*s)}k(t,s){return this.add(t.i(this).scale(r(s)))}H(){return(255*this.r|0)+(255*this.C<<8)+(255*this.b<<16)+(255*this.a<<24)}}class d{constructor(t){this.time=null==t?void 0:C+t,this.setTime=t}set(t=0){this.time=C+t,this.setTime=t}N(){this.time=void 0}$(){return null!=this.time}active(){return C<=this.time}F(){return C>this.time}get(){return this.$()?C-this.time:0}S(){return this.$()?o(this.time-C,this.setTime,0):0}}let f=c(1920,1200),p=c(),w=c(16),m=c(1),g=c(),v=n(w.x,w.y);let y,x,b,M,A=[],k=[],T=0,C=0,H=0,N=0,$=0,F=0;const S="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)";function D(s,i,n,h,o,u){_.onerror=_.onload=()=>{x=c(.3).h(y=c(_.width,_.height)),document.body.style="margin:0;overflow:hidden;background:#000;touch-action:none;user-select:none;-webkit-user-select:none;-moz-user-select:none",document.body.appendChild(z=document.createElement("canvas")),E=z.getContext("2d"),z.style=S,function(){0;lt=document.createElement("canvas"),dt=lt.getContext("webgl",{antialias:!1}),lt.style=S,ft=function(t){if(!t||!t.width)return;const s=dt.createTexture();return dt.bindTexture(Ft,s),dt.texImage2D(Ft,0,Ot,Ot,St,t),dt.texParameteri(Ft,zt,Pt),dt.texParameteri(Ft,_t,Pt),dt.texParameteri(Ft,Et,qt),dt.texParameteri(Ft,Lt,qt),s}(_),document.body.appendChild(lt),wt=function(t,s){0;const i=dt.createProgram();return dt.attachShader(i,Mt(t,Wt)),dt.attachShader(i,Mt(s,It)),dt.linkProgram(i),i}("precision highp float;uniform mat4 m;attribute vec2 p,t;attribute vec4 c,a;varying vec2 v;varying vec4 d,e;void main(){gl_Position=m*vec4(p,1,1);v=t;d=c;e=a;}","precision highp float;varying vec2 v;varying vec4 d,e;uniform sampler2D s;void main(){gl_FragColor=texture2D(s,v)*d+e;}");const t=new ArrayBuffer(Jt*jt*Vt);(function(t,s,i){0;const e=dt.createBuffer();dt.bindBuffer(t,e),dt.bufferData(t,s,i)})(Bt,t.byteLength,Gt),mt=new Float32Array(t),gt=new Uint32Array(t);let s=vt=0;const i=(t,i,e,n,h=0)=>{const r=dt.getAttribLocation(wt,t);dt.enableVertexAttribArray(r),dt.vertexAttribPointer(r,n,i,h,Vt,s),s+=n*e};i("p",Dt,4,2),i("t",Dt,4,2),i("c",St,1,4,1),i("a",St,1,4,1)}(),document.body.appendChild(L=document.createElement("canvas")),R=L.getContext("2d"),L.style=S,s(),a()};const a=(s=0)=>{let u=s-$;if($=s,t&&(b=((t,s=0,i=1)=>s+r(t)*(i-s))(.05,b||0,1e3/(u||1))),H+=u/1e3,F=e(F+!N*u,50),p.x){L.width=z.width=p.x,L.height=z.height=p.y;const t=innerWidth/innerHeight,s=z.width/z.height;z.style.width=L.style.width=t<s?"100%":"",z.style.height=L.style.height=t<s?"":"100%",lt&&(lt.style.width=z.style.width,lt.style.height=z.style.height)}else L.width=z.width=e(innerWidth,f.x),L.height=z.height=e(innerHeight,f.y);if(q=c(z.width,z.height),N)tt(),n(),st();else{let t=0;for(F<0&&F>-9&&(t=F,F=0);F>=0;F-=1e3/60)tt(),i(),O(),n(),st();F+=t}q=c(z.width,z.height),E.imageSmoothingEnabled=!1,function(t,s,i,e,n){dt.viewport(0,0,lt.width=t,lt.height=s),dt.clear(Rt),dt.bindTexture(Ft,pt=ft),dt.useProgram(wt),bt();const h=2*n/t,r=2*n/s;dt.uniformMatrix4fv(dt.getUniformLocation(wt,"m"),0,new Float32Array([h,0,0,0,0,r,0,0,1,1,-1,1,-1-h*i,-1-r*e,0,0]))}(z.width,z.height,g.x,g.y,v),h(),A.sort(((t,s)=>t.D-s.D));for(const t of A)t.O||t.P();if(o(),function(t,s){if(!vt&&!s)return;At(),s&&t.drawImage(lt,0,0)}(E),t){R.textAlign="right",R.textBaseline="top",R.font="1em monospace",R.fillStyle="#000";const t="LittleJS v1.3.8 / "+M+" / "+A.length+" / "+b.toFixed(1)+" GL";R.fillText(t,z.width-3,3),R.fillStyle="#fff",R.fillText(t,z.width-2,2),M=0}requestAnimationFrame(a)};u?_.src=u:_.onload()}function O(){k=A.filter((t=>t._));const t=s=>{if(!s.O){s.update();for(const i of s.children)t(i)}};for(const s of A)s.parent||t(s);A=A.filter((t=>!t.O)),C=++T/60}class P{constructor(t=c(),s=m,i=-1,e=w,n=0,h,r=0){this.L=t.t(),this.size=s,this.R,this.q=i,this.B=e,this.angle=n,this.color=h,this.G,this.D=r,this.I=C,this.children=[],A.push(this)}update(){const t=this.parent;t&&(this.L=this.W.multiply(c(t.j(),1)).rotate(-t.angle).add(t.L),this.angle=t.j()*this.U+t.angle)}P(){I(this.L,this.R||this.size,this.q,this.B,this.color,this.angle,this.J,this.G)}V(){if(!this.O){this.O=1,this.parent&&this.parent.removeChild(this);for(const t of this.children)t.V(t.parent=0)}}K(){return C-this.I}j(){return this.J?-1:1}X(t,s=c(),i=0){this.children.push(t),t.parent=this,t.W=s.t(),t.U=i}removeChild(t){this.children.splice(this.children.indexOf(t),1),t.parent=0}}const _=new Image;let z,E,L,R,q=c();const B=t=>t.add(c(.5)).i(q.scale(.5)).multiply(c(1/v,-1/v)).add(g),G=t=>t.i(g).multiply(c(v,-v)).add(q.scale(.5)).i(c(.5));function I(s,i=c(1),e=-1,n=w,h=new l,r=0,o,u=new l(0,0,0,0),a=1){if(t&&++M,a)if(e<0||!_.width)kt(s.x,s.y,i.x,i.y,r,0,0,0,0,0,h.H());else{const t=y.x/n.x|0,c=n.x/y.x,a=n.y/y.y,l=e%t*c,d=(e/t|0)*a;kt(s.x,s.y,o?-i.x:i.x,i.y,r,l+x.x,d+x.y,l-x.x+c,d-x.y+a,h.H(),u.H())}else!function(t,s,i,e,n,h=E){t=G(t),s=s.scale(v),h.save(),h.translate(t.x+.5|0,t.y-.5|0),h.rotate(i),h.scale(e?-s.x:s.x,s.y),n(h),h.restore()}(s,i,r,o,(t=>{if(e<0)t.fillStyle=h,t.fillRect(-.5,-.5,1,1);else{const s=y.x/n.x|0,i=e%s*n.x+.3,r=(e/s|0)*n.y+.3,o=n.x-.6,u=n.y-.6;t.globalAlpha=h.a,t.drawImage(_,i,r,o,u,-.5,-.5,1,1)}}))}function W(t,s,i,e,n){I(t,s,-1,w,i,e,0,0,n)}const j=(t,s=0)=>Z[s]&&1&Z[s][t]?1:0,U=(t,s=0)=>Z[s]&&2&Z[s][t]?1:0,J=U;let V=c(),K=c(),Q=0,X=0;const Y=(t,s=0)=>j(t,s+1);let Z=[[]];function tt(){document.hasFocus()||(Z=[[]]),V=B(K),function(){0;if(!navigator.getGamepads||!document.hasFocus())return;const t=navigator.getGamepads();for(let s=t.length;s--;){const i=t[s],e=Z[s+1]||(Z[s+1]=[]),n=nt[s]||(nt[s]=[]);if(i){const t=.3,h=.8,r=s=>s>t?o(s,t,h):s<-t?-o(-s,t,h):0;for(let t=0;t<i.axes.length-1;t+=2)n[t>>1]=c(r(i.axes[t]),r(-i.axes[t+1])).p();for(let t=i.buttons.length;t--;){const n=i.buttons[t];e[t]=n.pressed?1+2*!Y(t,s):4*Y(t,s),X|=!s&&n.pressed}{const t=c(Y(15,s)-Y(14,s),Y(12,s)-Y(13,s));t.o()&&(n[0]=t.p())}}}}()}function st(){for(const t of Z)for(const s in t)t[s]&=1;Q=0}onkeydown=t=>{t.repeat||(Z[X=0][it(t.keyCode)]=3)},onkeyup=t=>{Z[0][it(t.keyCode)]=4};const it=t=>87==t?38:83==t?40:65==t?37:68==t?39:t;onmousedown=t=>{Z[X=0][t.button]=3,onmousemove(t),t.button&&t.preventDefault()},onmouseup=t=>Z[0][t.button]=2&Z[0][t.button]|4,onmousemove=t=>K=et(t),onwheel=t=>t.ctrlKey||(Q=h(t.deltaY)),oncontextmenu=t=>!1;const et=t=>{if(!z)return c();const s=z.getBoundingClientRect();return c(z.width,z.height).multiply(c(o(t.x,s.left,s.right),o(t.y,s.top,s.bottom)))},nt=[];const ht=void 0!==window.ontouchstart;if(ht){let t,s;ontouchstart=ontouchmove=ontouchend=i=>{i.button=0;const e=i.touches.length;return e?(s||ut(0,s=1),i.x=i.touches[0].clientX,i.y=i.touches[0].clientY,t?onmousemove(i):onmousedown(i)):t&&onmouseup(i),t=e,!i.cancelable}}new d,c();let rt;function ot(t,s=1,i=1,e=0,n=0){if(rt||(rt=new(window.AudioContext||webkitAudioContext)),rt.resume(),"running"!=rt.state)return;const h=rt.createBuffer(t.length,t[0].length,ct),o=rt.createBufferSource();t.forEach(((t,s)=>h.getChannelData(s).set(t))),o.buffer=h,o.playbackRate.value=i,o.loop=n;const u=rt.createGain();return u.gain.value=.5*s,u.connect(rt.destination),(window.StereoPannerNode?o.connect(new StereoPannerNode(rt,{pan:r(e,-1,1)})):o).connect(u),o.start(),o}const ut=(...t)=>ot([at(...t)]),ct=44100;function at(t=1,r=.05,o=220,c=0,a=0,l=.1,d=0,f=1,p=0,w=0,m=0,g=0,v=0,y=0,x=0,b=0,M=0,A=1,k=0,T=0){let C,H,N=2*s,$=p*=500*N/ct/ct,F=[],S=o*=(1+r*u(-1,1))*N/ct,D=0,O=0,P=0,_=1,z=0,E=0,L=0;for(w*=500*N/ct**3,x*=N/ct,m*=N/ct,g*=ct,v=v*ct|0,H=(c=c*ct+9)+(k*=ct)+(a*=ct)+(l*=ct)+(M*=ct)|0;P<H;F[P++]=L)++E%(100*b|0)||(L=d?d>1?d>2?d>3?Math.sin((D%N)**3):n(e(Math.tan(D),1),-1):1-(2*D/N%2+2)%2:1-4*i(Math.round(D/N)-D/N):Math.sin(D),L=(v?1-T+T*Math.sin(N*P/v):1)*h(L)*i(L)**f*t*.5*(P<c?P/c:P<c+k?1-(P-c)/k*(1-A):P<c+k+a?A:P<H-M?(H-P-M)/l*A:0),L=M?L/2+(M>P?0:(P<H-M?1:(H-P)/M)*F[P-M|0]/2):L),C=(o+=p+=w)*Math.cos(x*O++),D+=C-C*y*(1-1e9*(Math.sin(P)+1)%2),_&&++_>g&&(o+=m,S+=m,_=0),!v||++z%v||(o=S,p=$,_=_||1);return F}let lt,dt,ft,pt,wt,mt,gt,vt,yt,xt;function bt(t){xt=t}function Mt(t,s){const i=dt.createShader(s);return dt.shaderSource(i,t),dt.compileShader(i),i}function At(){if(!vt)return;const t=yt?Tt:Nt;dt.blendFuncSeparate(Ht,t,Tt,t),dt.enable($t),dt.bufferSubData(Bt,0,mt.subarray(0,vt*jt*Ut)),dt.drawArrays(Ct,0,vt*jt),vt=0,yt=xt}function kt(t,s,i,e,n,h,r,o,u,c=4294967295,a=0){vt!=Jt&&yt==xt||At();const l=Math.cos(n)/2,d=Math.sin(n)/2,f=l*i,p=l*e,w=d*i,m=d*e;let g=vt++*jt*Ut;mt[g++]=t-f-m,mt[g++]=s-p+w,mt[g++]=h,mt[g++]=u,gt[g++]=c,gt[g++]=a,mt[g++]=t+f+m,mt[g++]=s+p-w,mt[g++]=o,mt[g++]=r,gt[g++]=c,gt[g++]=a,mt[g++]=t-f+m,mt[g++]=s+p+w,mt[g++]=h,mt[g++]=r,gt[g++]=c,gt[g++]=a,mt[g++]=t-f-m,mt[g++]=s-p+w,mt[g++]=h,mt[g++]=u,gt[g++]=c,gt[g++]=a,mt[g++]=t+f-m,mt[g++]=s-p-w,mt[g++]=o,mt[g++]=u,gt[g++]=c,gt[g++]=a,mt[g++]=t+f+m,mt[g++]=s+p-w,mt[g++]=o,mt[g++]=r,gt[g++]=c,gt[g++]=a}const Tt=1,Ct=4,Ht=770,Nt=771,$t=3042,Ft=3553,St=5121,Dt=5126,Ot=6408,Pt=9728,_t=10240,zt=10241,Et=10242,Lt=10243,Rt=16384,qt=33071,Bt=34962,Gt=35048,It=35632,Wt=35633,jt=6,Ut=6,Jt=65536,Vt=24,Kt={Y:null,Z:!1};window.addEventListener("load",(()=>{v=128,f=c(1600,900),t=!0,w=c(32),Kt.tt.init(),D((()=>{Kt.Y=new Kt.it.st(new Kt.et),Kt.nt=Kt.ht.get()}),(()=>{if(Kt.Z)return;const t=Kt.Y.rt;t&&t.ot<=0&&(Kt.Z=!0,Kt.tt.ut())}),(()=>{Kt.Z||(U(27)&&(N=!N),N||Kt.Y.update())}),(()=>{}),(()=>{Kt.Z||(Kt.Y.ct(),Kt.tt.lt())}),"tiles.png")})),Kt.dt=class extends P{constructor(t,s,i,e,n){super(s,i,e,n||w,0),this.ft=new d(((t=1,s=0)=>0|u(t,s))(5,1)),this.type=t;const h=[];h[Kt.dt.wt]=[1,2,4,1,1,24,0],h[Kt.dt.gt]=[1,1,3,1,1,25,0],h[Kt.dt.vt]=[2,2,4,2,2,8,w];const r=h[t];r&&(this.ot=r[0],this.yt=r[1],this.xt=r[2],this.bt=r[3],this.Mt=r[4]+.5,this.At=r[5],this.q=r[5],this.B=r[6]||c(16)),this.kt=!0,this.Tt=!0}Ct(){let t=null;const s=Kt.Y.rt,i=this.L.u(s.L);if(i<=this.xt){const n=Kt.Y.Ht(s.L);if(!(n&&n.find((t=>t.type===Kt.$t.Nt))))if(this.Tt&&i<=this.Mt)t=this.Ft(s),this.Tt=!1;else if(this.kt){let n=s.L.i(this.L).normalize(),h=e(this.yt,i),o=null;for(;h>=1&&(o=this.L.add(n.scale(h)),o.x=Math.round(r(o.x,0,Kt.Y.size.x-1)),o.y=Math.round(r(o.y,0,Kt.Y.size.y-1)),Kt.Y.Ht(o));)h--;h>=1&&(t=this.St(o.x,o.y)),this.kt=!1}}return t}Dt(){this.Ot&&this.Ot.remove(),Kt.ht.Pt(this),Kt.Y._t(this.L),this.V()}Ft(t){const s=new d(.5);let i=!1;return e=>{i?s.F()&&e():(t.ot-=this.bt,t.ot<=0&&t.Dt(),i=!0)}}St(t,s){const i=.25*this.L.u(c(t,s)),e=new d(i),n=this.L.t();let h=n;return this.angle=.1,this.J=t<this.L.x,i=>{this.zt=!0;const r=Math.sin(Math.PI/2*e.S());this.L.x=n.x*(1-r)+t*r,this.L.y=n.y*(1-r)+s*r;h.u(this.L)>=.5&&(this.angle*=-1,h=this.L.t()),this.D=this.L.y,e.F()&&(this.angle=0,this.zt=!1,this===Kt.Y.rt&&this.ot--,i())}}P(){if(!N&&this!==Kt.Y.rt){const t=Kt.Y.Ht(this.L);if(t&&t.find((t=>t.type===Kt.$t.Nt)))return;i(V.x-this.L.x)<this.size.x/2&&(i(V.y-this.L.y),this.size.y)}super.P()}update(){this.type===Kt.dt.wt&&(this.zt?this.q=this.At:this.ot>0&&(this.q=this.At,this.ft.F()?this.ft.set(2.5):this.ft.get()>=-.2&&(this.q=this.At+1))),super.update()}},Kt.dt.wt=1,Kt.dt.gt=2,Kt.dt.vt=3,Kt.$t=class extends P{constructor(t,s){super(s),this.type=t,this.type===Kt.$t.Et?(this.L.x+=u(.1,-.1),this.L.y+=u(.1,-.1)):this.type===Kt.$t.Nt&&(this.D=s.y)}P(){if(this.type===Kt.$t.Et)I(this.L,c(.5),10,c(16));else if(this.type===Kt.$t.Nt){let t=this.L.t();t.x+=.05*Math.sin(C),t.y+=.02*Math.cos(this.I+C),I(t,c(1),3)}}},Kt.$t.Et=1,Kt.$t.Nt=2,Kt.et=class extends Kt.dt{constructor(t){super(0,t,c(.5),16,c(16)),this.ot=5,this.yt=3,this.bt=1,this.Mt=1.5}Ft(t){const s=new d(.3),i=new d;let e=!1,n=this.L,h=t.L,r=0;return o=>{if(r=s.F()?Math.sqrt(i.S()):Math.sqrt(s.S()),s.F()&&!e)i.set(.3),n=t.L.t(),h=this.L.t(),t.ot-=this.bt,t.ot<=0&&(t.Dt(),this.ot++),e=!0;else if(i.F())return void o();g.x=n.x*(1-r)+h.x*r,g.y=n.y*(1-r)+h.y*r}}update(){this.zt?this.q=16:this.ot>0&&(this.q=16,this.ft.F()?this.ft.set(3):this.ft.get()>=-1&&(this.q=17)),super.update()}},Kt.it=class{constructor(t){this.size=t,this.step=0,Kt.ht.reset(),this.Lt=[...Array(this.size.x)].map((t=>[])),this.Rt=[],this.qt=[],this.Bt=[],this.Gt={}}_t(t){this.Rt.push(new Kt.$t(Kt.$t.Et,t))}It(t,s){const i=new P(t,c(1),s);return i.D=t.y+.5,i}Ht(t){return this.Gt[t.toString()]}ct(){}update(){g=this.rt.L.t(),Kt.ht.Wt()}jt(){this.Gt={};const t=t=>{if(t.O)return;const s=t.L.toString();this.Gt[s]=this.Gt[s]||[],this.Gt[s].push(t)};this.Bt.forEach((s=>t(s))),this.qt.forEach((s=>t(s))),t(this.rt)}},Kt.it.Ut=class extends Kt.it{constructor(){super(c(9,15));for(let t=0;t<this.size.x;t++)for(let s=0;s<this.size.y;s++){let i=new l(.2,.2,.25);if(s>=this.size.y-2){if(t<3||t>5)continue;s===this.size.y-1&&(i=new l(.22,.22,.27))}const e=new Kt.Jt(c(t,s),i,6);this.Lt[e.L.x][e.L.y]=e}this.rt=new Kt.et(c(4,4)),Kt.ht.Vt(this.rt);[c(5,6),c(3,7)].forEach((t=>{const s=new Kt.dt(Kt.dt.wt,t,c(.5));this.qt.push(s),Kt.ht.Vt(s)})),this.Bt.push(this.It(c(0,14),2),this.It(c(1,14),2),this.It(c(2,14),2),this.It(c(0,13),2),this.It(c(1,13),2),this.It(c(2,13),2),this.It(c(6,14),2),this.It(c(7,14),2),this.It(c(8,14),2),this.It(c(6,13),2),this.It(c(7,13),2),this.It(c(8,13),2),this.It(c(2,10.25),0),this.It(c(6,10.25),0),this.It(c(2,7.25),0),this.It(c(6,7.25),0),this.It(c(2,4.25),0),this.It(c(6,4.25),0),this.It(c(2,1.25),0),this.It(c(6,1.25),0)),this.jt(),g=this.rt.L}Kt(){return this.rt.L.y>=this.size.y-1&&(this.V(),Kt.Y=new Kt.it.st(this.rt),!0)}V(){this.Rt.forEach((t=>t.V())),this.qt.forEach((t=>t.V())),this.Bt.forEach((t=>t.V())),this.Lt.forEach((t=>t.forEach((t=>t.V()))))}ct(){this.step<3&&I(c(1,2.4),c(4),5)}update(){0==this.step?Kt.tt.Qt("h1","Hel, Ruler of Niflheim","Pitiful soul! Once proud warrior that unfortunately passed of sickness or old age and where thus cast into my Niflheim! Rejoice, for you are granted a chance to die honorably and ascend into the ranks of Valhalla!",(()=>this.step=1)):1==this.step?Kt.tt.Qt("h2","Hel, Ruler of Niflheim","I have granted you a brittle body and weapon, so that you may fight and absorb the soul power of those slayed.",(()=>this.step=2)):2==this.step&&Kt.tt.Qt("h3","Hel, Ruler of Niflheim","The trial begins! First fight your way out of my hall!",(()=>this.step=3)),this.step<3||super.update()}},Kt.it.st=class extends Kt.it{constructor(t){super(c(10,10));for(let t=0;t<this.size.x;t++)for(let s=0;s<this.size.y;s++){const i=new l(.4,.7,.8),e=new Kt.Jt(c(t,s),i,7);this.Lt[e.L.x][e.L.y]=e}this.Bt.push(new Kt.$t(Kt.$t.Nt,c(4,3)),new Kt.$t(Kt.$t.Nt,c(6,4))),this.rt=t,t.L=c(5,0),t.D=t.L.y,t.kt=!0,t.Tt=!0,Kt.ht.reset(),Kt.ht.Vt(t);[c(5,6),c(3,7)].forEach((t=>{const s=new Kt.dt(Kt.dt.vt,t);this.qt.push(s),Kt.ht.Vt(s)})),this.jt(),g=t.L}Kt(){return!1}},Kt.Jt=class extends P{constructor(t,s,i=-1){super(t,m,i,w,0,s),this.Xt=!1,this.Yt=!1,this.D=-1}P(){W(this.L,this.size,this.color),super.P(),this.Xt?I(this.L,c(1),11,c(16)):this.Yt&&I(this.L,c(1),3,c(16))}update(){this.Yt=!1,this.Xt=!1,super.update()}},Kt.ht={Zt:[],ts:0,ss:null,Vt(t){this.Zt.push(t)},es:t=>t&&t.find((t=>t instanceof Kt.dt)),ns:t=>!t||!t.find((t=>t.type!==Kt.$t.Nt)),Wt(){if(this.ss)this.ss((t=>this.hs()));else if(this.rs()){const t=Math.round(V.x),s=Math.round(V.y),i=Kt.Y.Lt[t]?.[s];if(i){const e=c(t,s).u(Kt.nt.L),n=Kt.Y.Ht(c(t,s));let h=null;Kt.nt.kt&&this.ns(n)?e<=Kt.nt.yt&&(i.Yt=!0,J(0)&&(this.ss=Kt.nt.St(t,s),Kt.nt.kt=!1)):Kt.nt.Tt&&(h=this.es(n))&&h!==Kt.nt&&e<=Kt.nt.Mt&&(i.Xt=!0,J(0)&&(this.ss=Kt.nt.Ft(h),Kt.nt.Tt=!1))}}else Kt.nt&&(this.ss=Kt.nt.Ct(),this.ss||(Kt.nt.Tt=!1,Kt.nt.kt=!1,this.hs()))},hs(){Kt.Y.jt(),this.rs()&&Kt.Y.Kt()||(this.ss=null,Kt.nt.kt||Kt.nt.Tt||(Kt.nt.kt=!0,Kt.nt.Tt=!0,Kt.nt=this.next()))},get(){return this.Zt[this.ts]},rs(){return this.get()===Kt.Y.rt},next(){return++this.ts>=this.Zt.length&&(this.ts=0),this.get()},Pt(t){for(let s=0;s<this.Zt.length;s++){if(this.Zt[s]===t){this.Zt.splice(s,1),s<=this.ts&&this.ts--;break}}},reset(){this.Zt=[],this.ts=0,this.ss=null}},Kt.tt={os:new DOMParser,us:{},lt(){const t=Kt.Y.rt;if(t){R.imageSmoothingEnabled=!1;for(let s=0;s<t.ot;s++)R.drawImage(_,32,0,16,16,16+42*s,16,32,32);this.cs.disabled=!Kt.ht.rs()}},ls(t,s){const i=this.os.parseFromString(`<div style="background:#000a;border:2px solid #fff;padding:10px;position:absolute;text-transform:uppercase;z-index:1">${t}</div>`,"text/html").body.firstChild;return document.body.append(i),this.ds(i,{L:s}),i},init(){const t=this.os.parseFromString('<button style="position:absolute;left:45%;top:20px;z-index:1">End Turn</button>',"text/html").body.firstChild;document.body.append(t),t.onclick=()=>{Kt.nt.kt=!1,Kt.nt.Tt=!1,Kt.ht.hs()},this.cs=t},ut(){if(this.fs)return;const t=this.os.parseFromString('<div style="background:#000a;color:#c7e;font-size:32px;font-style:italic;font-weight:600;height:100vh;padding-top:45%;position:absolute;text-align:center;width:100%">With your body prematurely destroyed,<br>your soulâ€™s home remains Niflheim.<br><br>END</div>',"text/html").body.firstChild;document.body.append(t),this.fs=t},Qt(t,s,i,n){let h=this.us[t];if(!h){const r=e(800,z.width),o=20+(window.innerHeight-z.height)/2,u=(window.innerWidth-r-20)/2;h=this.os.parseFromString(`<div style="background:#000c;border:4px solid #fff;bottom:${o}px;display:flex;flex-direction:column;left:${u}px;min-height:200px;padding:10px;position:absolute;width:${r}px"><div style="color:#c7e;font-style:italic;font-weight:600;margin:0 0 10px">${s}</div><div style="flex: 1 1">${i}</div><div class="n" style="background:#fff;color:#000;font-weight:600;margin:10px 0 0;padding:10px;text-align:center">Continue</div></div>`,"text/html").body.firstChild,document.body.append(h),h.querySelector(".n").onclick=()=>{h.remove(),delete this.us[t],n()},this.us[t]=h}},ds(t,s){if(s.L){const i=t.getBoundingClientRect();t.style.left=Math.round(s.L.x-i.width/2)+"px",t.style.top=Math.round(s.L.y-i.height-48)+"px"}}},Kt.ps=class extends P{constructor(t){super(t?t.L:c(0),c(1)),this.bt=1,this.Mt=1,this.name=null,this.ws=t}P(){this.ws&&super.P()}update(){this.ws&&super.update()}};