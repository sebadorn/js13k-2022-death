let t=0;const s=Math.PI,i=t=>t<0?-t:t,e=(t,s)=>t<s?t:s,n=(t,s)=>t>s?t:s,h=t=>t<0?-1:1,o=(t,s=0,i=1)=>t<s?s:t>i?i:t,r=(t,s=0,i=1)=>i-s?o((t-s)/(i-s)):0,c=(t=1,s=0)=>s+(t-s)*Math.random();const u=(t=0,s)=>null==t.x?new a(t,s??t):new a(t.x,t.y);class a{constructor(t=0,s=0){this.x=t,this.y=s}t(){return new a(this.x,this.y)}add(t){return new a(this.x+t.x,this.y+t.y)}i(t){return new a(this.x-t.x,this.y-t.y)}multiply(t){return new a(this.x*t.x,this.y*t.y)}h(t){return new a(this.x/t.x,this.y/t.y)}scale(t){return new a(this.x*t,this.y*t)}length(){return this.o()**.5}o(){return this.x**2+this.y**2}u(t){return this.l(t)**.5}l(t){return(this.x-t.x)**2+(this.y-t.y)**2}normalize(t=1){const s=this.length();return s?this.scale(t/s):new a(0,t)}p(t=1){const s=this.length();return s>t?this.scale(t/s):this}m(t){return this.x*t.x+this.y*t.y}g(t){return this.x*t.y-this.y*t.x}angle(){return Math.atan2(this.x,this.y)}v(t=0,s=1){return this.x=s*Math.sin(t),this.y=s*Math.cos(t),this}rotate(t){const s=Math.cos(t),i=Math.sin(t);return new a(this.x*s-this.y*i,this.x*i+this.y*s)}direction(){return i(this.x)>i(this.y)?this.x<0?3:1:this.y<0?2:0}M(){return new a(this.y,-this.x)}floor(){return new a(Math.floor(this.x),Math.floor(this.y))}A(){return i(this.x*this.y)}k(t,s){return this.add(t.i(this).scale(o(s)))}T(t){return this.x>=0&&this.y>=0&&this.x<t.x&&this.y<t.y}toString(){return`(${(this.x<0?"":" ")+this.x.toFixed(0)},${(this.y<0?"":" ")+this.y.toFixed(0)} )`}}class l{constructor(t=1,s=1,i=1,e=1){this.r=t,this.C=s,this.b=i,this.a=e}t(){return new l(this.r,this.C,this.b,this.a)}add(t){return new l(this.r+t.r,this.C+t.C,this.b+t.b,this.a+t.a)}i(t){return new l(this.r-t.r,this.C-t.C,this.b-t.b,this.a-t.a)}multiply(t){return new l(this.r*t.r,this.C*t.C,this.b*t.b,this.a*t.a)}scale(t,s=t){return new l(this.r*t,this.C*t,this.b*t,this.a*s)}k(t,s){return this.add(t.i(this).scale(o(s)))}N(){return(255*this.r|0)+(255*this.C<<8)+(255*this.b<<16)+(255*this.a<<24)}}class d{constructor(t){this.time=null==t?void 0:C+t,this.setTime=t}set(t=0){this.time=C+t,this.setTime=t}_(){this.time=void 0}P(){return null!=this.time}active(){return C<=this.time}S(){return C>this.time}get(){return this.P()?C-this.time:0}$(){return this.P()?r(this.time-C,this.setTime,0):0}}let f=u(1920,1200),p=u(),w=u(16),m=u(1),g=u(),v=n(w.x,w.y);let y,b,M,x,A=[],k=[],T=0,C=0,N=0,_=0,P=0,S=0;const $="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)";function F(s,i,n,h,r,c){D.onerror=D.onload=()=>{b=u(.3).h(y=u(D.width,D.height)),document.body.style="margin:0;overflow:hidden;background:#000;touch-action:none;user-select:none;-webkit-user-select:none;-moz-user-select:none",document.body.appendChild(O=document.createElement("canvas")),W=O.getContext("2d"),O.style=$,function(){0;lt=document.createElement("canvas"),dt=lt.getContext("webgl",{antialias:!1}),lt.style=$,ft=function(t){if(!t||!t.width)return;const s=dt.createTexture();return dt.bindTexture(St,s),dt.texImage2D(St,0,Ht,Ht,$t,t),dt.texParameteri(St,Ot,zt),dt.texParameteri(St,Dt,zt),dt.texParameteri(St,Wt,qt),dt.texParameteri(St,Lt,qt),s}(D),document.body.appendChild(lt),wt=function(t,s){0;const i=dt.createProgram();return dt.attachShader(i,xt(t,It)),dt.attachShader(i,xt(s,Gt)),dt.linkProgram(i),i}("precision highp float;uniform mat4 m;attribute vec2 p,t;attribute vec4 c,a;varying vec2 v;varying vec4 d,e;void main(){gl_Position=m*vec4(p,1,1);v=t;d=c;e=a;}","precision highp float;varying vec2 v;varying vec4 d,e;uniform sampler2D s;void main(){gl_FragColor=texture2D(s,v)*d+e;}");const t=new ArrayBuffer(Vt*jt*Jt);(function(t,s,i){0;const e=dt.createBuffer();dt.bindBuffer(t,e),dt.bufferData(t,s,i)})(Bt,t.byteLength,Et),mt=new Float32Array(t),gt=new Uint32Array(t);let s=vt=0;const i=(t,i,e,n,h=0)=>{const o=dt.getAttribLocation(wt,t);dt.enableVertexAttribArray(o),dt.vertexAttribPointer(o,n,i,h,Jt,s),s+=n*e};i("p",Ft,4,2),i("t",Ft,4,2),i("c",$t,1,4,1),i("a",$t,1,4,1)}(),document.body.appendChild(L=document.createElement("canvas")),R=L.getContext("2d"),L.style=$,s(),a()};const a=(s=0)=>{let c=s-P;if(P=s,t&&(M=((t,s=0,i=1)=>s+o(t)*(i-s))(.05,M||0,1e3/(c||1))),N+=c/1e3,S=e(S+!_*c,50),p.x){L.width=O.width=p.x,L.height=O.height=p.y;const t=innerWidth/innerHeight,s=O.width/O.height;O.style.width=L.style.width=t<s?"100%":"",O.style.height=L.style.height=t<s?"":"100%",lt&&(lt.style.width=O.style.width,lt.style.height=O.style.height)}else L.width=O.width=e(innerWidth,f.x),L.height=O.height=e(innerHeight,f.y);if(q=u(O.width,O.height),_)tt(),n(),st();else{let t=0;for(S<0&&S>-9&&(t=S,S=0);S>=0;S-=1e3/60)tt(),i(),H(),n(),st();S+=t}q=u(O.width,O.height),W.imageSmoothingEnabled=!1,function(t,s,i,e,n){dt.viewport(0,0,lt.width=t,lt.height=s),dt.clear(Rt),dt.bindTexture(St,pt=ft),dt.useProgram(wt),Mt();const h=2*n/t,o=2*n/s;dt.uniformMatrix4fv(dt.getUniformLocation(wt,"m"),0,new Float32Array([h,0,0,0,0,o,0,0,1,1,-1,1,-1-h*i,-1-o*e,0,0]))}(O.width,O.height,g.x,g.y,v),h(),A.sort(((t,s)=>t.F-s.F));for(const t of A)t.H||t.D();if(r(),function(t,s){if(!vt&&!s)return;At(),s&&t.drawImage(lt,0,0)}(W),t){R.textAlign="right",R.textBaseline="top",R.font="1em monospace",R.fillStyle="#000";const t="LittleJS v1.3.8 / "+x+" / "+A.length+" / "+M.toFixed(1)+" GL";R.fillText(t,O.width-3,3),R.fillStyle="#fff",R.fillText(t,O.width-2,2),x=0}requestAnimationFrame(a)};c?D.src=c:D.onload()}function H(){k=A.filter((t=>t.O));const t=s=>{if(!s.H){s.update();for(const i of s.children)t(i)}};for(const s of A)s.parent||t(s);A=A.filter((t=>!t.H)),C=++T/60}class z{constructor(t=u(),s=m,i=-1,e=w,n=0,h,o=0){this.W=t.t(),this.size=s,this.L,this.R=i,this.q=e,this.angle=n,this.color=h,this.B,this.F=o,this.G=C,this.children=[],A.push(this)}update(){const t=this.parent;t&&(this.W=this.I.multiply(u(t.j(),1)).rotate(-t.angle).add(t.W),this.angle=t.j()*this.U+t.angle)}D(){G(this.W,this.L||this.size,this.R,this.q,this.color,this.angle,this.V,this.B)}J(){if(!this.H){this.H=1,this.parent&&this.parent.removeChild(this);for(const t of this.children)t.J(t.parent=0)}}K(){return C-this.G}j(){return this.V?-1:1}X(t,s=u(),i=0){this.children.push(t),t.parent=this,t.I=s.t(),t.U=i}removeChild(t){this.children.splice(this.children.indexOf(t),1),t.parent=0}}const D=new Image;let O,W,L,R,q=u();const B=t=>t.add(u(.5)).i(q.scale(.5)).multiply(u(1/v,-1/v)).add(g),E=t=>t.i(g).multiply(u(v,-v)).add(q.scale(.5)).i(u(.5));function G(s,i=u(1),e=-1,n=w,h=new l,o=0,r,c=new l(0,0,0,0),a=1){if(t&&++x,a)if(e<0||!D.width)kt(s.x,s.y,i.x,i.y,o,0,0,0,0,0,h.N());else{const t=y.x/n.x|0,u=n.x/y.x,a=n.y/y.y,l=e%t*u,d=(e/t|0)*a;kt(s.x,s.y,r?-i.x:i.x,i.y,o,l+b.x,d+b.y,l-b.x+u,d-b.y+a,h.N(),c.N())}else!function(t,s,i,e,n,h=W){t=E(t),s=s.scale(v),h.save(),h.translate(t.x+.5|0,t.y-.5|0),h.rotate(i),h.scale(e?-s.x:s.x,s.y),n(h),h.restore()}(s,i,o,r,(t=>{if(e<0)t.fillStyle=h,t.fillRect(-.5,-.5,1,1);else{const s=y.x/n.x|0,i=e%s*n.x+.3,o=(e/s|0)*n.y+.3,r=n.x-.6,c=n.y-.6;t.globalAlpha=h.a,t.drawImage(D,i,o,r,c,-.5,-.5,1,1)}}))}function I(t,s,i,e,n){G(t,s,-1,w,i,e,0,0,n)}const j=(t,s=0)=>Z[s]&&1&Z[s][t]?1:0,U=(t,s=0)=>Z[s]&&2&Z[s][t]?1:0,V=U;let J=u(),K=u(),Q=0,X=0;const Y=(t,s=0)=>j(t,s+1);let Z=[[]];function tt(){document.hasFocus()||(Z=[[]]),J=B(K),function(){0;if(!navigator.getGamepads||!document.hasFocus())return;const t=navigator.getGamepads();for(let s=t.length;s--;){const i=t[s],e=Z[s+1]||(Z[s+1]=[]),n=nt[s]||(nt[s]=[]);if(i){const t=.3,h=.8,o=s=>s>t?r(s,t,h):s<-t?-r(-s,t,h):0;for(let t=0;t<i.axes.length-1;t+=2)n[t>>1]=u(o(i.axes[t]),o(-i.axes[t+1])).p();for(let t=i.buttons.length;t--;){const n=i.buttons[t];e[t]=n.pressed?1+2*!Y(t,s):4*Y(t,s),X|=!s&&n.pressed}{const t=u(Y(15,s)-Y(14,s),Y(12,s)-Y(13,s));t.o()&&(n[0]=t.p())}}}}()}function st(){for(const t of Z)for(const s in t)t[s]&=1;Q=0}onkeydown=t=>{t.repeat||(Z[X=0][it(t.keyCode)]=3)},onkeyup=t=>{Z[0][it(t.keyCode)]=4};const it=t=>87==t?38:83==t?40:65==t?37:68==t?39:t;onmousedown=t=>{Z[X=0][t.button]=3,onmousemove(t),t.button&&t.preventDefault()},onmouseup=t=>Z[0][t.button]=2&Z[0][t.button]|4,onmousemove=t=>K=et(t),onwheel=t=>t.ctrlKey||(Q=h(t.deltaY)),oncontextmenu=t=>!1;const et=t=>{if(!O)return u();const s=O.getBoundingClientRect();return u(O.width,O.height).multiply(u(r(t.x,s.left,s.right),r(t.y,s.top,s.bottom)))},nt=[];const ht=void 0!==window.ontouchstart;if(ht){let t,s;ontouchstart=ontouchmove=ontouchend=i=>{i.button=0;const e=i.touches.length;return e?(s||ct(0,s=1),i.x=i.touches[0].clientX,i.y=i.touches[0].clientY,t?onmousemove(i):onmousedown(i)):t&&onmouseup(i),t=e,!i.cancelable}}new d,u();let ot;function rt(t,s=1,i=1,e=0,n=0){if(ot||(ot=new(window.AudioContext||webkitAudioContext)),ot.resume(),"running"!=ot.state)return;const h=ot.createBuffer(t.length,t[0].length,ut),r=ot.createBufferSource();t.forEach(((t,s)=>h.getChannelData(s).set(t))),r.buffer=h,r.playbackRate.value=i,r.loop=n;const c=ot.createGain();return c.gain.value=.5*s,c.connect(ot.destination),(window.StereoPannerNode?r.connect(new StereoPannerNode(ot,{pan:o(e,-1,1)})):r).connect(c),r.start(),r}const ct=(...t)=>rt([at(...t)]),ut=44100;function at(t=1,o=.05,r=220,u=0,a=0,l=.1,d=0,f=1,p=0,w=0,m=0,g=0,v=0,y=0,b=0,M=0,x=0,A=1,k=0,T=0){let C,N,_=2*s,P=p*=500*_/ut/ut,S=[],$=r*=(1+o*c(-1,1))*_/ut,F=0,H=0,z=0,D=1,O=0,W=0,L=0;for(w*=500*_/ut**3,b*=_/ut,m*=_/ut,g*=ut,v=v*ut|0,N=(u=u*ut+9)+(k*=ut)+(a*=ut)+(l*=ut)+(x*=ut)|0;z<N;S[z++]=L)++W%(100*M|0)||(L=d?d>1?d>2?d>3?Math.sin((F%_)**3):n(e(Math.tan(F),1),-1):1-(2*F/_%2+2)%2:1-4*i(Math.round(F/_)-F/_):Math.sin(F),L=(v?1-T+T*Math.sin(_*z/v):1)*h(L)*i(L)**f*t*.5*(z<u?z/u:z<u+k?1-(z-u)/k*(1-A):z<u+k+a?A:z<N-x?(N-z-x)/l*A:0),L=x?L/2+(x>z?0:(z<N-x?1:(N-z)/x)*S[z-x|0]/2):L),C=(r+=p+=w)*Math.cos(b*H++),F+=C-C*y*(1-1e9*(Math.sin(z)+1)%2),D&&++D>g&&(r+=m,$+=m,D=0),!v||++O%v||(r=$,p=P,D=D||1);return S}let lt,dt,ft,pt,wt,mt,gt,vt,yt,bt;function Mt(t){bt=t}function xt(t,s){const i=dt.createShader(s);return dt.shaderSource(i,t),dt.compileShader(i),i}function At(){if(!vt)return;const t=yt?Tt:_t;dt.blendFuncSeparate(Nt,t,Tt,t),dt.enable(Pt),dt.bufferSubData(Bt,0,mt.subarray(0,vt*jt*Ut)),dt.drawArrays(Ct,0,vt*jt),vt=0,yt=bt}function kt(t,s,i,e,n,h,o,r,c,u=4294967295,a=0){vt!=Vt&&yt==bt||At();const l=Math.cos(n)/2,d=Math.sin(n)/2,f=l*i,p=l*e,w=d*i,m=d*e;let g=vt++*jt*Ut;mt[g++]=t-f-m,mt[g++]=s-p+w,mt[g++]=h,mt[g++]=c,gt[g++]=u,gt[g++]=a,mt[g++]=t+f+m,mt[g++]=s+p-w,mt[g++]=r,mt[g++]=o,gt[g++]=u,gt[g++]=a,mt[g++]=t-f+m,mt[g++]=s+p+w,mt[g++]=h,mt[g++]=o,gt[g++]=u,gt[g++]=a,mt[g++]=t-f-m,mt[g++]=s-p+w,mt[g++]=h,mt[g++]=c,gt[g++]=u,gt[g++]=a,mt[g++]=t+f-m,mt[g++]=s-p-w,mt[g++]=r,mt[g++]=c,gt[g++]=u,gt[g++]=a,mt[g++]=t+f+m,mt[g++]=s+p-w,mt[g++]=r,mt[g++]=o,gt[g++]=u,gt[g++]=a}const Tt=1,Ct=4,Nt=770,_t=771,Pt=3042,St=3553,$t=5121,Ft=5126,Ht=6408,zt=9728,Dt=10240,Ot=10241,Wt=10242,Lt=10243,Rt=16384,qt=33071,Bt=34962,Et=35048,Gt=35632,It=35633,jt=6,Ut=6,Vt=65536,Jt=24,Kt={Y:null,Z:!1};window.addEventListener("load",(()=>{v=128,f=u(1600,900),t=!0,w=u(32),Kt.tt.init(),F((()=>{Kt.Y=new Kt.it.st,Kt.et=Kt.nt.get()}),(()=>{if(Kt.Z)return;Q<0?v-=32:Q>0&&(v+=32),v=o(v,96,256);const t=Kt.Y.ht;t&&t.ot<=0&&(Kt.Z=!0,Kt.tt.rt())}),(()=>{Kt.Z||(U(27)&&(_=!_),_||Kt.Y.update())}),(()=>{}),(()=>{Kt.Z||(Kt.Y.ct(),Kt.tt.ut())}),"tiles.png")})),Kt.lt=class extends z{constructor(t,s,i,e,n){super(s,i,e,n||w,0),this.dt=new d(((t=1,s=0)=>0|c(t,s))(5,1)),this.type=t;const h=[];h[Kt.lt.ft]=[8,2,4,1,1,24,0],h[Kt.lt.wt]=[8,1,3,1,1,25,0],h[Kt.lt.gt]=[20,1,4,2,1,8,w],h[Kt.lt.vt]=[10,1,20,1,1,48,0];const o=h[t];o&&(this.ot=o[0],this.yt=o[1],this.bt=o[2],this.Mt=o[3],this.xt=o[4]+.5,this.At=o[5],this.R=o[5],this.q=o[6]||u(16)),this.kt=this.ot,this.Tt=this.yt,this.Ct=1,this.Nt=0}_t(t){const s=new d(.4),i=new d;this.angle=.1,this.V=t.W.x<this.W.x;const e=this.W.t();let n=this.W.t(),h=this.W.t(),o=t.W,r=!1,c=0;const u=this===Kt.Y.ht;return a=>{if(this.Pt=!0,s.S()?(c=i.$(),this.V=t.W.x>e.x):(c=s.$(),this.V=t.W.x<e.x),s.S()&&!r)i.set(.3),o=h.t(),h=t.W,t.ot-=this.Mt,t.ot<=0&&(t.St(),u&&(this.ot+=t.kt)),r=!0;else if(i.S())return this.angle=0,this.Pt=!1,this.V=t.W.x<e.x,this.W=e,this.ot-=this.Nt,void a();this.W.x=h.x*(1-c)+o.x*c,this.W.y=h.y*(1-c)+o.y*c;n.u(this.W)>=.5&&(this.angle*=-1,n=this.W.t()),u&&(g=e)}}$t(){let t=null;const s=Kt.Y.ht,i=this.W.u(s.W);if(i<=this.bt){const n=Kt.Y.Ft(s.W);if(!(n&&n.find((t=>t.type===Kt.zt.Ht))))if(this.Ct&&i<=this.xt)t=this.Dt(s),this.Ct--;else if(this.Tt){let n=s.W.i(this.W).normalize(),h=e(this.Tt,i),r=null;for(;h>=1&&(r=this.W.add(n.scale(h)),r.x=Math.round(o(r.x,0,Kt.Y.size.x-1)),r.y=Math.round(o(r.y,0,Kt.Y.size.y-1)),Kt.Y.Ft(r));)h--;h>=1&&(t=this.Ot(r.x,r.y)),this.Tt=0}}return t}St(){this.Wt&&this.Wt.remove(),Kt.nt.Lt(this),Kt.Y.Rt(this.W),this.J()}Dt(t){return this._t(t)}Ot(t,s){const i=.25*this.W.u(u(t,s)),e=new d(i),n=this.W.t();let h=n;return this.angle=.1,this.V=t<this.W.x,i=>{this.Pt=!0;const o=Math.sin(Math.PI/2*e.$());this.W.x=n.x*(1-o)+t*o,this.W.y=n.y*(1-o)+s*o;h.u(this.W)>=.5&&(this.angle*=-1,h=this.W.t()),this.F=this.W.y,e.S()&&(this.angle=0,this.Pt=!1,i())}}D(){let t=this.W.t();if(!_){if(this!==Kt.Y.ht){const t=Kt.Y.Ft(this.W);if(t&&t.find((t=>t.type===Kt.zt.Ht)))return;i(J.x-this.W.x)<this.size.x/2&&(i(J.y-this.W.y),this.size.y)}this.type===Kt.lt.vt&&(this.W.y+=.05*Math.sin(C))}super.D(),this.W=t}update(){this.type>0&&(this.Pt?this.R=this.At:this.ot>0&&(this.R=this.At,this.type!==Kt.lt.vt&&(this.dt.S()?this.dt.set(2.5):this.dt.get()>=-.5&&(this.R=this.At+1)))),super.update()}},Kt.lt.ft=1,Kt.lt.wt=2,Kt.lt.gt=3,Kt.lt.vt=4,Kt.zt=class extends z{constructor(t,s){super(s),this.type=t,this.type===Kt.zt.qt?(this.W.x+=c(.1,-.1),this.W.y+=c(.1,-.1)):this.type===Kt.zt.Ht&&(this.F=s.y+1)}D(){if(this.type===Kt.zt.qt)G(this.W,u(.5),10,u(16));else if(this.type===Kt.zt.Ht){let t=this.W.t();t.x+=.05*Math.sin(C),t.y+=.02*Math.cos(this.G+C),G(t,u(1),3)}}},Kt.zt.qt=1,Kt.zt.Ht=2,Kt.Bt=class extends Kt.lt{constructor(t){super(0,t,u(.5),16,u(16)),this.ot=100,this.yt=3,this.Tt=this.yt,this.Et(0)}Gt(t){t.sort(((t,s)=>t.W.u(this.W)-s.W.u(this.W)));const s=t[t.length-1],i=.2*this.W.u(s.W),e=new d(i),h=new z(u(0),u(.5),2,u(16));return h.V=t[0].W.x<this.W.x,i=>{if(e.S())t.forEach(((t,s)=>{t.ot-=n(this.Mt-2*s,0),t.ot<=0&&(t.St(),this.ot+=t.kt)})),this.ot-=this.Nt,h.J(),i();else{const t=e.$();h.angle=t*Math.PI*4,h.W.x=s.W.x*t+this.W.x*(1-t),h.W.y=s.W.y*t+this.W.y*(1-t)}}}It(t){return s=>{t.forEach((t=>{t.ot-=this.Mt,t.ot<=0&&(t.St(),this.ot+=t.kt)})),this.ot-=this.Nt,s()}}Dt(t){return 1==this.jt?this.It(t):2==this.jt?this.Gt(t):this._t(t)}Et(t){const s=[[10,1.5,0],[10,1.5,10],[10,4.5,10]][t];this.jt=t,this.Mt=s[0],this.xt=s[1],this.Nt=s[2]}update(){this.Pt?this.R=16:this.ot>0&&(this.R=16,this.dt.S()?this.dt.set(3):this.dt.get()>=-1&&(this.R=17)),super.update()}},Kt.it=class{constructor(t){this.size=t,this.step=0,Kt.nt.reset(),this.Ut=[...Array(this.size.x)].map((t=>[])),this.Vt=[],this.Jt=[],this.Kt=[],this.Qt={}}Rt(t){this.Vt.push(new Kt.zt(Kt.zt.qt,t))}Xt(t,s){const i=new z(t,m,s);return i.F=t.y+.5,i}Ft(t){return this.Qt[t.toString()]}ct(){}update(){g=this.ht.W.t(),Kt.nt.Yt()}Zt(){this.Qt={};const t=t=>{if(t.H)return;const s=t.W.toString();this.Qt[s]=this.Qt[s]||[],this.Qt[s].push(t)};this.Kt.forEach((s=>t(s))),this.Jt.forEach((s=>t(s))),t(this.ht)}},Kt.it.st=class extends Kt.it{constructor(){super(u(15,15));for(let t=0;t<this.size.y;t++)for(let s=0;s<this.size.x;s++){let i="       ,              ,       wwwwwww,wwwwwwwp,,,,,p,p,,,,,p,,,,,,,,,,,,,,,,,    ,,,    ,,,,wwww,,,wwww,,,,,,,p,,,p,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,    ,p,,,p,        ,,,,,,,        ,,,,,,,        ,p,,,p,        ,,,,,,,    "[(this.size.y-1-t)*this.size.x+s];if(" "!==i){if(","===i||"p"===i){const i=c(.005,-.005);let e=new l(.2+i,.2+i,.25+i);const n=new Kt.ts(u(s,t),e,6);this.Ut[n.W.x][n.W.y]=n}if("w"===i)this.Kt.push(this.Xt(u(s,t),2));else if("p"===i){const i=this.Xt(u(s,t+.25),0);i.F=i.W.y+1.5,this.Kt.push(i)}}}this.ht=new Kt.Bt(u(7,1)),Kt.nt.ss(this.ht),this.Vt.push(new z(this.ht.W,u(1),7));[u(6,4),u(6,5)].forEach((t=>{const s=new Kt.lt(Kt.lt.ft,t,u(.5));this.Jt.push(s),Kt.nt.ss(s)})),this.Zt(),g=this.ht.W}es(){return this.ht.W.y>=this.size.y-1}J(){this.Vt.forEach((t=>t.J())),this.Jt.forEach((t=>t.J())),this.Kt.forEach((t=>t.J())),this.Ut.forEach((t=>t.forEach((t=>t.J()))))}ct(){this.step<3&&(R.imageSmoothingEnabled=!1,R.drawImage(D,32,32,32,32,n(Math.round(.5*L.width-700),0),Math.round(.5*L.height),512,512));const t=new l(1,1,1,.02);I(u(7,13.25),u(1,2.5),t),I(u(7,13.5),u(1,2),t),I(u(7,13.75),u(1,1.5),t),I(u(7,14),u(1,1),t),I(u(7,14.25),u(1,.5),t)}update(){0==this.step?Kt.tt.ns("h1","Hel, Ruler of Niflheim","Pitiful soul! Once proud warrior that unfortunately passed of sickness or old age and where thus cast into my Niflheim! Rejoice, for you are granted a chance to die honorably and ascend into the ranks of Valhalla!",(()=>this.step=1)):1==this.step?Kt.tt.ns("h2","Hel, Ruler of Niflheim","I have granted you a brittle body and weapon, so that you may fight and absorb the soul power of those slayed.",(()=>this.step=2)):2==this.step&&Kt.tt.ns("h3","Hel, Ruler of Niflheim","The trial begins! First fight your way out of my hall!",(()=>this.step=3)),this.step<3||super.update()}},Kt.ts=class extends z{constructor(t,s,i=-1){super(t,m,i,w,0,s),this.hs=!1,this.os=!1,this.F=-1}D(){I(this.W,this.size,this.color),super.D(),this.hs?G(this.W,u(1),11,u(16)):this.os&&G(this.W,u(1),3,u(16))}update(){this.os=!1,this.hs=!1,super.update()}},Kt.nt={rs:[],cs:0,us:null,ls(){let t="";const s=Math.round(J.x),i=Math.round(J.y),e=Kt.Y.Ut[s]?.[i],n=Kt.et;if(e){const h=u(s,i).u(n.W),o=Kt.Y.Ft(u(s,i));let r=null;if(n.Tt&&this.ds(n,e,o))h<=n.Tt&&(e.os=!0,t="pointer",V(0)&&(this.us=n.Ot(s,i),n.Tt-=Math.round(10*h)/10,n.Tt<1&&(n.Tt=0)));else if(n.Ct&&(r=this.fs(o))&&r!==n&&h<=n.xt){let s=null;(s=this.ps(e,n,r))&&(t="crosshair",V(0)&&(this.us=n.Dt(s),n.Ct--))}}Kt.tt.ws(t)},ps(t,s,i){let e=[i];const n=s.W.t();if(n.x=Math.round(n.x),n.y=Math.round(n.y),1==s.jt){[u(n.x+1,n.y+1),u(n.x+1,n.y-1),u(n.x+1,n.y),u(n.x-1,n.y+1),u(n.x-1,n.y-1),u(n.x-1,n.y),u(n.x,n.y+1),u(n.x,n.y-1)].forEach((t=>{const s=Kt.Y.Ut[t.x]?.[t.y];if(s){s.hs=!0;const i=Kt.Y.Ft(t);if(i){const t=i.find((t=>t instanceof Kt.lt));t&&!e.includes(t)&&e.push(t)}}}))}else if(2==s.jt){const i=[],h=t.W.i(s.W).normalize();let o=s.W.u(t.W);const r=t=>!(t instanceof Kt.lt||t instanceof Kt.zt);for(;o>=1;){const t=n.add(h.scale(o));t.x=Math.round(t.x),t.y=Math.round(t.y);const s=Kt.Y.Ut[t.x]?.[t.y];if(!s)return null;{const n=Kt.Y.Ft(t);if(n){if(n.find(r))return null;const t=n.find((t=>t instanceof Kt.lt));t&&!e.includes(t)&&e.push(t)}i.push(s)}o--}i.forEach((t=>t.hs=!0))}else e=i;return t.hs=!0,e},ss(t){this.rs.push(t)},fs:t=>t&&t.find((t=>t instanceof Kt.lt)),ds(t,s,i){const e=t.W.i(s.W).normalize();let n=s.W.u(t.W);for(;n>=1;){const i=s.W.add(e.scale(n));if(i.x=Math.round(i.x),i.y=Math.round(i.y),(i.x!==t.W.x||i.y!==t.W.y)&&Kt.Y.Ft(i))return!1;n--}return!i},Yt(){this.us?this.us((t=>this.gs())):this.vs()?this.ls():Kt.et&&(this.us=Kt.et.$t(),this.us||(Kt.et.Ct=0,Kt.et.Tt=0,this.gs()))},gs(){Kt.Y.Zt(),this.vs()&&Kt.Y.es()||(this.us=null,Kt.et.Tt||Kt.et.Ct||(Kt.et.Tt=Kt.et.yt,Kt.et.Ct=1,Kt.et=this.next()))},get(){return this.rs[this.cs]},vs(){return this.get()===Kt.Y.ht},next(){return++this.cs>=this.rs.length&&(this.cs=0),this.get()},Lt(t){for(let s=0;s<this.rs.length;s++){if(this.rs[s]===t){this.rs.splice(s,1),s<=this.cs&&this.cs--;break}}},reset(){this.rs=[],this.cs=0,this.us=null}},Kt.tt={ys:new DOMParser,bs:{},ws(t){document.body.style.cursor=t},ut(){const t=Kt.Y.ht;t&&(R.font="600 16px monospace",R.fillStyle="#fff",R.fillText("SP "+t.ot.toFixed(0),16,28),R.fillText("MV "+t.Tt.toFixed(0),16,50),this.Ms.hidden=!Kt.nt.vs())},xs(t,s){const i=this.ys.parseFromString(`<div style="background:#000a;border:2px solid #fff;padding:10px;position:absolute;text-transform:uppercase;z-index:1">${t}</div>`,"text/html").body.firstChild;return document.body.append(i),this.As(i,{W:s}),i},init(){const t=this.ys.parseFromString('<button style="position:absolute;left:45%;top:20px;z-index:1">End Turn</button>',"text/html").body.firstChild,s=this.ys.parseFromString('<div style="position:absolute;left:45%;top:60px;z-index:1"><button id="a0" class="a">Normal</button><button id="a1">Whirlwind</button><button id="a2">Throw</button></div>',"text/html").body.firstChild;document.body.append(t,s),t.onclick=()=>{Kt.et.Tt=0,Kt.et.Ct=0,Kt.nt.gs()};const i=[];s.querySelectorAll("button").forEach((t=>{i.push(t),t.onclick=s=>{i.forEach((t=>t.className="")),Kt.et.Et(Number(t.id.substring(1))),t.className="a"}})),this.Ms=t},rt(){if(this.ks)return;const t=this.ys.parseFromString('<div style="background:#000a;color:#c7e;font-size:32px;font-style:italic;font-weight:600;height:100vh;padding-top:45%;position:absolute;text-align:center;width:100%">With your body prematurely destroyed,<br>your soulâ€™s home remains Niflheim.<br><br>END</div>',"text/html").body.firstChild;document.body.append(t),this.ks=t},ns(t,s,i,n){let h=this.bs[t];if(!h){const o=e(800,O.width),r=20+(window.innerHeight-O.height)/2,c=(window.innerWidth-o-20)/2;h=this.ys.parseFromString(`<div style="background:#000c;border:4px solid #fff;bottom:${r}px;display:flex;flex-direction:column;left:${c}px;min-height:200px;padding:10px;position:absolute;width:${o}px"><div style="color:#c7e;font-style:italic;font-weight:600;margin:0 0 10px">${s}</div><div style="flex: 1 1">${i}</div><div class="n" style="background:#fff;color:#000;cursor:pointer;font-weight:600;margin:10px 0 0;padding:10px;text-align:center">Continue</div></div>`,"text/html").body.firstChild,document.body.append(h),h.querySelector(".n").onclick=s=>{h.remove(),delete this.bs[t],n()},this.bs[t]=h}},As(t,s){if(s.W){const i=t.getBoundingClientRect();t.style.left=Math.round(s.W.x-i.width/2)+"px",t.style.top=Math.round(s.W.y-i.height-48)+"px"}}},Kt.Ts=class extends z{constructor(t){super(t?t.W:u(0),u(1)),this.Mt=1,this.xt=1,this.name=null,this.Cs=t}D(){this.Cs&&super.D()}update(){this.Cs&&super.update()}};