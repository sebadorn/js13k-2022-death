let t=0;const s=Math.PI,i=t=>t<0?-t:t,h=(t,s)=>t<s?t:s,e=(t,s)=>t>s?t:s,n=t=>t<0?-1:1,o=(t,s=0,i=1)=>t<s?s:t>i?i:t,r=(t,s=0,i=1)=>i-s?o((t-s)/(i-s)):0,c=(t=1,s=0)=>s+(t-s)*Math.random();const u=(t=0,s)=>null==t.x?new a(t,s??t):new a(t.x,t.y);class a{constructor(t=0,s=0){this.x=t,this.y=s}t(){return new a(this.x,this.y)}add(t){return new a(this.x+t.x,this.y+t.y)}i(t){return new a(this.x-t.x,this.y-t.y)}multiply(t){return new a(this.x*t.x,this.y*t.y)}h(t){return new a(this.x/t.x,this.y/t.y)}scale(t){return new a(this.x*t,this.y*t)}length(){return this.o()**.5}o(){return this.x**2+this.y**2}u(t){return this.l(t)**.5}l(t){return(this.x-t.x)**2+(this.y-t.y)**2}normalize(t=1){const s=this.length();return s?this.scale(t/s):new a(0,t)}p(t=1){const s=this.length();return s>t?this.scale(t/s):this}m(t){return this.x*t.x+this.y*t.y}g(t){return this.x*t.y-this.y*t.x}angle(){return Math.atan2(this.x,this.y)}v(t=0,s=1){return this.x=s*Math.sin(t),this.y=s*Math.cos(t),this}rotate(t){const s=Math.cos(t),i=Math.sin(t);return new a(this.x*s-this.y*i,this.x*i+this.y*s)}direction(){return i(this.x)>i(this.y)?this.x<0?3:1:this.y<0?2:0}M(){return new a(this.y,-this.x)}floor(){return new a(Math.floor(this.x),Math.floor(this.y))}A(){return i(this.x*this.y)}S(t,s){return this.add(t.i(this).scale(o(s)))}T(t){return this.x>=0&&this.y>=0&&this.x<t.x&&this.y<t.y}toString(){return`(${(this.x<0?"":" ")+this.x.toFixed(0)},${(this.y<0?"":" ")+this.y.toFixed(0)} )`}}class l{constructor(t=1,s=1,i=1,h=1){this.r=t,this.P=s,this.b=i,this.a=h}t(){return new l(this.r,this.P,this.b,this.a)}add(t){return new l(this.r+t.r,this.P+t.P,this.b+t.b,this.a+t.a)}i(t){return new l(this.r-t.r,this.P-t.P,this.b-t.b,this.a-t.a)}multiply(t){return new l(this.r*t.r,this.P*t.P,this.b*t.b,this.a*t.a)}scale(t,s=t){return new l(this.r*t,this.P*t,this.b*t,this.a*s)}S(t,s){return this.add(t.i(this).scale(o(s)))}k(){return(255*this.r|0)+(255*this.P<<8)+(255*this.b<<16)+(255*this.a<<24)}toString(){return`rgba(${255*this.r|0},${255*this.P|0},${255*this.b|0},${this.a.toFixed(3)})`}}class f{constructor(t){this.time=null==t?void 0:P+t,this.setTime=t}set(t=0){this.time=P+t,this.setTime=t}D(){this.time=void 0}_(){return null!=this.time}active(){return P<=this.time}C(){return P>this.time}get(){return this._()?P-this.time:0}H(){return this._()?r(this.time-P,this.setTime,0):0}}let d=u(1920,1200),w=u(),p=u(16),m=u(1),g=u(),v=e(p.x,p.y);let y,M,b,x,A=[],S=[],T=0,P=0,k=0,D=0,_=0,C=0;const H="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)";function $(s,i,e,n,r,c){O.onerror=O.onload=()=>{M=u(.3).h(y=u(O.width,O.height)),document.body.style="touch-action:none;-webkit-user-select:none;-moz-user-select:none",document.body.appendChild(B=document.createElement("canvas")),E=B.getContext("2d"),B.style=H,function(){0;lt=document.createElement("canvas"),ft=lt.getContext("webgl",{antialias:!1}),lt.style=H,dt=function(t){if(!t||!t.width)return;const s=ft.createTexture();return ft.bindTexture(Ct,s),ft.texImage2D(Ct,0,Nt,Nt,Ht,t),ft.texParameteri(Ct,Bt,Ft),ft.texParameteri(Ct,Ot,Ft),ft.texParameteri(Ct,Et,Lt),ft.texParameteri(Ct,Vt,Lt),s}(O),document.body.appendChild(lt),pt=function(t,s){0;const i=ft.createProgram();return ft.attachShader(i,xt(t,Gt)),ft.attachShader(i,xt(s,zt)),ft.linkProgram(i),i}("precision highp float;uniform mat4 m;attribute vec2 p,t;attribute vec4 c,a;varying vec2 v;varying vec4 d,e;void main(){gl_Position=m*vec4(p,1,1);v=t;d=c;e=a;}","precision highp float;varying vec2 v;varying vec4 d,e;uniform sampler2D s;void main(){gl_FragColor=texture2D(s,v)*d+e;}");const t=new ArrayBuffer(jt*Rt*Jt);(function(t,s,i){0;const h=ft.createBuffer();ft.bindBuffer(t,h),ft.bufferData(t,s,i)})(Ut,t.byteLength,qt),mt=new Float32Array(t),gt=new Uint32Array(t);let s=vt=0;const i=(t,i,h,e,n=0)=>{const o=ft.getAttribLocation(pt,t);ft.enableVertexAttribArray(o),ft.vertexAttribPointer(o,e,i,n,Jt,s),s+=e*h};i("p",$t,4,2),i("t",$t,4,2),i("c",Ht,1,4,1),i("a",Ht,1,4,1)}(),document.body.appendChild(V=document.createElement("canvas")),I=V.getContext("2d"),V.style=H,s(),a()};const a=(s=0)=>{let c=s-_;if(_=s,t&&(b=((t,s=0,i=1)=>s+o(t)*(i-s))(.05,b||0,1e3/(c||1))),k+=c/1e3,C=h(C+!D*c,50),w.x){V.width=B.width=w.x,V.height=B.height=w.y;const t=innerWidth/innerHeight,s=B.width/B.height;B.style.width=V.style.width=t<s?"100%":"",B.style.height=V.style.height=t<s?"":"100%",lt&&(lt.style.width=B.style.width,lt.style.height=B.style.height)}else V.width=B.width=h(innerWidth,d.x),V.height=B.height=h(innerHeight,d.y);if(L=u(B.width,B.height),D)tt(),e(),st();else{let t=0;for(C<0&&C>-9&&(t=C,C=0);C>=0;C-=1e3/60)tt(),i(),N(),e(),st();C+=t}L=u(B.width,B.height),E.imageSmoothingEnabled=!1,function(t,s,i,h,e){ft.viewport(0,0,lt.width=t,lt.height=s),ft.clear(It),ft.bindTexture(Ct,wt=dt),ft.useProgram(pt),bt();const n=2*e/t,o=2*e/s;ft.uniformMatrix4fv(ft.getUniformLocation(pt,"m"),0,new Float32Array([n,0,0,0,0,o,0,0,1,1,-1,1,-1-n*i,-1-o*h,0,0]))}(B.width,B.height,g.x,g.y,v),n(),A.sort(((t,s)=>t.$-s.$));for(const t of A)t.N||t.F();if(r(),function(t,s){if(!vt&&!s)return;At(),s&&t.drawImage(lt,0,0)}(E),t){I.textAlign="right",I.textBaseline="top",I.font="1em monospace",I.fillStyle="#000";const t="LittleJS v1.3.8 / "+x+" / "+A.length+" / "+b.toFixed(1)+" GL";I.fillText(t,B.width-3,3),I.fillStyle="#fff",I.fillText(t,B.width-2,2),x=0}requestAnimationFrame(a)};c?O.src=c:O.onload()}function N(){S=A.filter((t=>t.O));const t=s=>{if(!s.N){s.update();for(const i of s.children)t(i)}};for(const s of A)s.parent||t(s);A=A.filter((t=>!t.N)),P=++T/60}class F{constructor(t=u(),s=m,i=-1,h=p,e=0,n,o=0){this.B=t.t(),this.size=s,this.V,this.I=i,this.L=h,this.angle=e,this.color=n,this.U,this.$=o,this.q=P,this.children=[],A.push(this)}update(){const t=this.parent;t&&(this.B=this.G.multiply(u(t.R(),1)).rotate(-t.angle).add(t.B),this.angle=t.R()*this.W+t.angle)}F(){z(this.B,this.V||this.size,this.I,this.L,this.color,this.angle,this.j,this.U)}J(){if(!this.N){this.N=1,this.parent&&this.parent.removeChild(this);for(const t of this.children)t.J(t.parent=0)}}Y(){return P-this.q}R(){return this.j?-1:1}K(t,s=u(),i=0){this.children.push(t),t.parent=this,t.G=s.t(),t.W=i}removeChild(t){this.children.splice(this.children.indexOf(t),1),t.parent=0}}const O=new Image;let B,E,V,I,L=u();const U=t=>t.add(u(.5)).i(L.scale(.5)).multiply(u(1/v,-1/v)).add(g),q=t=>t.i(g).multiply(u(v,-v)).add(L.scale(.5)).i(u(.5));function z(s,i=u(1),h=-1,e=p,n=new l,o=0,r,c=new l(0,0,0,0),a=1){if(t&&++x,a)if(h<0||!O.width)St(s.x,s.y,i.x,i.y,o,0,0,0,0,0,n.k());else{const t=y.x/e.x|0,u=e.x/y.x,a=e.y/y.y,l=h%t*u,f=(h/t|0)*a;St(s.x,s.y,r?-i.x:i.x,i.y,o,l+M.x,f+M.y,l-M.x+u,f-M.y+a,n.k(),c.k())}else!function(t,s,i,h,e,n=E){t=q(t),s=s.scale(v),n.save(),n.translate(t.x+.5|0,t.y-.5|0),n.rotate(i),n.scale(h?-s.x:s.x,s.y),e(n),n.restore()}(s,i,o,r,(t=>{if(h<0)t.fillStyle=n,t.fillRect(-.5,-.5,1,1);else{const s=y.x/e.x|0,i=h%s*e.x+.3,o=(h/s|0)*e.y+.3,r=e.x-.6,c=e.y-.6;t.globalAlpha=n.a,t.drawImage(O,i,o,r,c,-.5,-.5,1,1)}}))}function G(t,s,i,h,e){z(t,s,-1,p,i,h,0,0,e)}const R=(t,s=0)=>Z[s]&&1&Z[s][t]?1:0,W=(t,s=0)=>Z[s]&&2&Z[s][t]?1:0,j=W;let J=u(),Y=u(),K=0,Q=0;const X=(t,s=0)=>R(t,s+1);let Z=[[]];function tt(){document.hasFocus()||(Z=[[]]),J=U(Y),function(){0;if(!navigator.getGamepads||!document.hasFocus())return;const t=navigator.getGamepads();for(let s=t.length;s--;){const i=t[s],h=Z[s+1]||(Z[s+1]=[]),e=et[s]||(et[s]=[]);if(i){const t=.3,n=.8,o=s=>s>t?r(s,t,n):s<-t?-r(-s,t,n):0;for(let t=0;t<i.axes.length-1;t+=2)e[t>>1]=u(o(i.axes[t]),o(-i.axes[t+1])).p();for(let t=i.buttons.length;t--;){const e=i.buttons[t];h[t]=e.pressed?1+2*!X(t,s):4*X(t,s),Q|=!s&&e.pressed}{const t=u(X(15,s)-X(14,s),X(12,s)-X(13,s));t.o()&&(e[0]=t.p())}}}}()}function st(){for(const t of Z)for(const s in t)t[s]&=1;K=0}onkeydown=t=>{t.repeat||(Z[Q=0][it(t.keyCode)]=3)},onkeyup=t=>{Z[0][it(t.keyCode)]=4};const it=t=>87==t?38:83==t?40:65==t?37:68==t?39:t;onmousedown=t=>{Z[Q=0][t.button]=3,onmousemove(t),t.button&&t.preventDefault()},onmouseup=t=>Z[0][t.button]=2&Z[0][t.button]|4,onmousemove=t=>Y=ht(t),onwheel=t=>t.ctrlKey||(K=n(t.deltaY)),oncontextmenu=t=>!1;const ht=t=>{if(!B)return u();const s=B.getBoundingClientRect();return u(B.width,B.height).multiply(u(r(t.x,s.left,s.right),r(t.y,s.top,s.bottom)))},et=[];const nt=void 0!==window.ontouchstart;if(nt){let t,s;ontouchstart=ontouchmove=ontouchend=i=>{i.button=0;const h=i.touches.length;return h?(s||ct(0,s=1),i.x=i.touches[0].clientX,i.y=i.touches[0].clientY,t?onmousemove(i):onmousedown(i)):t&&onmouseup(i),t=h,!i.cancelable}}new f,u();let ot;function rt(t,s=1,i=1,h=0,e=0){if(ot||(ot=new(window.AudioContext||webkitAudioContext)),ot.resume(),"running"!=ot.state)return;const n=ot.createBuffer(t.length,t[0].length,ut),r=ot.createBufferSource();t.forEach(((t,s)=>n.getChannelData(s).set(t))),r.buffer=n,r.playbackRate.value=i,r.loop=e;const c=ot.createGain();return c.gain.value=.5*s,c.connect(ot.destination),(window.StereoPannerNode?r.connect(new StereoPannerNode(ot,{pan:o(h,-1,1)})):r).connect(c),r.start(),r}const ct=(...t)=>rt([at(...t)]),ut=44100;function at(t=1,o=.05,r=220,u=0,a=0,l=.1,f=0,d=1,w=0,p=0,m=0,g=0,v=0,y=0,M=0,b=0,x=0,A=1,S=0,T=0){let P,k,D=2*s,_=w*=500*D/ut/ut,C=[],H=r*=(1+o*c(-1,1))*D/ut,$=0,N=0,F=0,O=1,B=0,E=0,V=0;for(p*=500*D/ut**3,M*=D/ut,m*=D/ut,g*=ut,v=v*ut|0,k=(u=u*ut+9)+(S*=ut)+(a*=ut)+(l*=ut)+(x*=ut)|0;F<k;C[F++]=V)++E%(100*b|0)||(V=f?f>1?f>2?f>3?Math.sin(($%D)**3):e(h(Math.tan($),1),-1):1-(2*$/D%2+2)%2:1-4*i(Math.round($/D)-$/D):Math.sin($),V=(v?1-T+T*Math.sin(D*F/v):1)*n(V)*i(V)**d*t*.5*(F<u?F/u:F<u+S?1-(F-u)/S*(1-A):F<u+S+a?A:F<k-x?(k-F-x)/l*A:0),V=x?V/2+(x>F?0:(F<k-x?1:(k-F)/x)*C[F-x|0]/2):V),P=(r+=w+=p)*Math.cos(M*N++),$+=P-P*y*(1-1e9*(Math.sin(F)+1)%2),O&&++O>g&&(r+=m,H+=m,O=0),!v||++B%v||(r=H,w=_,O=O||1);return C}let lt,ft,dt,wt,pt,mt,gt,vt,yt,Mt;function bt(t){Mt=t}function xt(t,s){const i=ft.createShader(s);return ft.shaderSource(i,t),ft.compileShader(i),i}function At(){if(!vt)return;const t=yt?Tt:Dt;ft.blendFuncSeparate(kt,t,Tt,t),ft.enable(_t),ft.bufferSubData(Ut,0,mt.subarray(0,vt*Rt*Wt)),ft.drawArrays(Pt,0,vt*Rt),vt=0,yt=Mt}function St(t,s,i,h,e,n,o,r,c,u=4294967295,a=0){vt!=jt&&yt==Mt||At();const l=Math.cos(e)/2,f=Math.sin(e)/2,d=l*i,w=l*h,p=f*i,m=f*h;let g=vt++*Rt*Wt;mt[g++]=t-d-m,mt[g++]=s-w+p,mt[g++]=n,mt[g++]=c,gt[g++]=u,gt[g++]=a,mt[g++]=t+d+m,mt[g++]=s+w-p,mt[g++]=r,mt[g++]=o,gt[g++]=u,gt[g++]=a,mt[g++]=t-d+m,mt[g++]=s+w+p,mt[g++]=n,mt[g++]=o,gt[g++]=u,gt[g++]=a,mt[g++]=t-d-m,mt[g++]=s-w+p,mt[g++]=n,mt[g++]=c,gt[g++]=u,gt[g++]=a,mt[g++]=t+d-m,mt[g++]=s-w-p,mt[g++]=r,mt[g++]=c,gt[g++]=u,gt[g++]=a,mt[g++]=t+d+m,mt[g++]=s+w-p,mt[g++]=r,mt[g++]=o,gt[g++]=u,gt[g++]=a}const Tt=1,Pt=4,kt=770,Dt=771,_t=3042,Ct=3553,Ht=5121,$t=5126,Nt=6408,Ft=9728,Ot=10240,Bt=10241,Et=10242,Vt=10243,It=16384,Lt=33071,Ut=34962,qt=35048,zt=35632,Gt=35633,Rt=6,Wt=6,jt=65536,Jt=24,Yt={X:null,Z:!1};window.addEventListener("load",(()=>{v=128,d=u(1600,900),t=!0,p=u(32),$((()=>{Yt.X=new Yt.st.tt,Yt.it=Yt.ht.get(),setTimeout((()=>Yt.et.init()),10)}),(()=>{if(Yt.Z)return;if(Yt.X.nt)return;K<0?v-=32:K>0&&(v+=32),v=o(v,96,256);const t=Yt.X.ot;t&&(t.rt<=0&&(Yt.Z=!0,Yt.et.ct()),W(49)||W(97)?t.ut(0):W(50)||W(98)?t.ut(1):(W(51)||W(99))&&t.ut(2))}),(()=>{Yt.Z||(W(27)&&(D=!D),Yt.X.update())}),(()=>{}),(()=>{D&&(I.fillStyle="#0007",I.fillRect(0,0,V.width,V.height),I.font="600 italic 72px monospace",I.textAlign="center",I.textBaseline="bottom",I.fillStyle="#0ac",I.fillText("PAUSED",.5*V.width-3,.5*V.height),I.fillStyle="#d0a",I.fillText("PAUSED",.5*V.width,.5*V.height)),Yt.Z||(Yt.X.lt(),Yt.X.nt||Yt.et.ft())}),"tiles.png")})),Yt.dt=class extends F{constructor(t,s,i,h,e){super(s,i,h,e||p,0),this.wt=new f(((t=1,s=0)=>0|c(t,s))(5,1)),this.type=t;const n=[];n[Yt.dt.gt]=[8,2,6,1,1,24,0],n[Yt.dt.vt]=[8,1,5,1,1,25,0],n[Yt.dt.yt]=[20,1,5,2,1,8,p],n[Yt.dt.Mt]=[10,1,20,1,1,36,0];const o=n[t];o&&(this.rt=o[0],this.bt=o[1],this.xt=o[2],this.At=o[3],this.St=o[4]+.5,this.Tt=o[5],this.I=o[5],this.L=o[6]||u(16)),this.Pt=this.rt,this.kt=this.bt,this.Dt=1,this._t=0}Ct(t){const s=new f(.4),i=new f;this.angle=.1,this.j=t.B.x<this.B.x;const h=this.B.t();let e=this.B.t(),n=this.B.t(),o=t.B,r=!1,c=0;const u=this===Yt.X.ot;return a=>{if(this.Ht=!0,s.C()?(c=i.H(),this.j=t.B.x>h.x):(c=s.H(),this.j=t.B.x<h.x),s.C()&&!r)i.set(.3),o=n.t(),n=t.B,t.rt-=this.At,t.rt<=0&&(t.$t(),u&&(this.rt+=t.Pt)),r=!0;else if(i.C())return this.angle=0,this.Ht=!1,this.j=t.B.x<h.x,this.B=h,this.rt-=this._t,void a();this.B.x=n.x*(1-c)+o.x*c,this.B.y=n.y*(1-c)+o.y*c;e.u(this.B)>=.5&&(this.angle*=-1,e=this.B.t()),u&&(g=h)}}Nt(){let t=null;const s=Yt.X.ot,i=this.B.u(s.B);if(i<=this.xt)if(this.Dt&&i<=this.St)t=this.Ft(s),this.Dt--;else if(this.kt){const e=s.B.i(this.B).normalize();let n=h(this.kt,i);const r=n;let c=null;for(;n>=1&&(c=this.B.add(e.scale(n)),c.x=Math.round(o(c.x,0,Yt.X.size.x-1)),c.y=Math.round(o(c.y,0,Yt.X.size.y-1)),Yt.X.Ot[c.x]?.[c.y])&&Yt.X.Bt(c);)n--;n!==r&&n>=1&&(t=this.Et(c.x,c.y)),this.kt=0}return t}$t(){this.Vt&&this.Vt.remove(),Yt.ht.It(this),Yt.X.Lt(this.B),this.J()}Ft(t){return this.Ct(t)}Et(t,s){const i=.25*this.B.u(u(t,s)),h=new f(i),e=this.B.t();let n=e;return this.angle=.1,this.j=t<this.B.x,i=>{this.Ht=!0;const o=Math.sin(Math.PI/2*h.H());this.B.x=e.x*(1-o)+t*o,this.B.y=e.y*(1-o)+s*o;n.u(this.B)>=.5&&(this.angle*=-1,n=this.B.t()),this.$=this.B.y,h.C()&&(this.angle=0,this.Ht=!1,i())}}F(){const t=this.B.t();if(!D){if(I.font="600 16px monospace",I.textAlign="center",i(J.x-this.B.x)<this.size.x/2&&i(J.y-this.B.y)<this.size.y/2){const s=q(u(t.x,t.y+.5));I.textBaseline="top",I.fillStyle="#000",I.fillText("SP "+this.rt,s.x-1,s.y+9),I.fillStyle="#fff",I.fillText("SP "+this.rt,s.x,s.y+8)}if(this.Ut){const s=q(u(t.x,t.y-.5));I.textBaseline="bottom",I.fillStyle="#000",I.fillText(-this.Ut+" SP",s.x-1,s.y+1),I.fillStyle="#f00",I.fillText(-this.Ut+" SP",s.x,s.y)}this.type===Yt.dt.Mt&&(this.B.y+=.05*Math.sin(P))}super.F(),this.B=t}update(){this.Ut=0,this.type>0&&(this.Ht?this.I=this.Tt:this.rt>0&&(this.I=this.Tt,this.type!==Yt.dt.Mt&&(this.wt.C()?this.wt.set(2.5):this.wt.get()>=-.5&&(this.I=this.Tt+1)))),super.update()}},Yt.dt.gt=1,Yt.dt.vt=2,Yt.dt.yt=3,Yt.dt.Mt=4,Yt.qt=class extends F{constructor(t,s){super(s),this.type=t,this.type===Yt.qt.zt&&(this.B.x+=c(.1,-.1),this.B.y+=c(.1,-.1))}F(){this.type===Yt.qt.zt&&z(this.B,u(.5),10,u(16))}},Yt.qt.zt=1,Yt.Gt=class extends Yt.dt{constructor(t){super(0,t,u(.5),16,u(16)),this.rt=100,this.bt=3,this.kt=this.bt,this.ut(0)}Rt(t){return s=>{t.forEach((t=>{t.rt-=this.At,t.rt<=0&&(t.$t(),this.rt+=t.Pt)})),this.rt-=this._t,s()}}Wt(t){const s=t[t.length-1],i=.2*this.B.u(s.B),h=new f(i),n=new F(u(0),u(.5),2,u(16));return n.j=t[0].B.x<this.B.x,i=>{if(h.C())t.forEach(((t,s)=>{t.rt-=e(this.At-2*s,0),t.rt<=0&&(t.$t(),this.rt+=t.Pt)})),this.rt-=this._t,n.J(),i();else{const t=h.H();n.angle=t*Math.PI*4,n.B.x=s.B.x*t+this.B.x*(1-t),n.B.y=s.B.y*t+this.B.y*(1-t)}}}Ft(t){return 1==this.jt?this.Rt(t):2==this.jt?this.Wt(t):this.Ct(t)}ut(t){const s=[[10,1.5,0],[10,1.5,20],[8,4.5,20]][t];this.jt=t,this.At=s[0],this.St=s[1],this._t=s[2]}update(){this.Ht?this.I=16:this.rt>0&&(this.I=16,this.wt.C()?this.wt.set(3):this.wt.get()>=-1&&(this.I=17)),super.update()}},Yt.st=class{constructor(t){this.size=t,this.step=0,Yt.ht.reset(),this.Ot=[...Array(this.size.x)].map((t=>[])),this.Jt=[],this.Yt=[],this.Kt=[],this.Qt={}}Lt(t){this.Jt.push(new Yt.qt(Yt.qt.zt,t))}Xt(t,s){const i=new F(t,m,s);return i.$=t.y+.5,i}Bt(t){return this.Qt[t.toString()]}lt(){}update(){g=this.ot.B.t(),Yt.ht.Zt()}ts(){this.Qt={};const t=t=>{if(t.N)return;const s=t.B.toString();this.Qt[s]=this.Qt[s]||[],this.Qt[s].push(t)};this.Kt.forEach((s=>t(s))),this.Yt.forEach((s=>t(s))),t(this.ot)}},Yt.st.tt=class extends Yt.st{constructor(){super(u(15,15));for(let t=0;t<this.size.y;t++)for(let s=0;s<this.size.x;s++){let i="       ,              ,       wwwwwww,wwwwwwwp,,,,,p,p,,,,,p,,,,,,,,,,,,,,,,,           ,,,,wwwwwwwwwww,,,,,,,p,,,p,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,    ,p,,,p,        ,,,,,,,        ,,,,,,,        ,p,,,p,        ,,,,,,,    "[(this.size.y-1-t)*this.size.x+s];if(" "!==i){if(","===i||"p"===i){const i=c(.005,-.005);let h=new l(.2+i,.2+i,.25+i);const e=new Yt.ss(u(s,t),h,6);this.Ot[e.B.x][e.B.y]=e}if("w"===i)this.Kt.push(this.Xt(u(s,t),2));else if("p"===i){const i=this.Xt(u(s,t+.25),0);i.$=i.B.y+1.5,this.Kt.push(i)}}}this.ot=new Yt.Gt(u(7,1)),Yt.ht.hs(this.ot),this.Jt.push(new F(this.ot.B,u(1),3));[[u(6,4),Yt.dt.gt],[u(6,5),Yt.dt.gt],[u(9,6),Yt.dt.gt],[u(2,11),Yt.dt.gt],[u(13,8),Yt.dt.gt],[u(7,6),Yt.dt.yt,1],[u(0,7),Yt.dt.Mt],[u(14,7),Yt.dt.Mt],[u(7,10),Yt.dt.yt,1]].forEach((t=>{const s=new Yt.dt(t[1],t[0],u(t[2]||.5));this.Yt.push(s),Yt.ht.hs(s)})),this.ts(),g=this.ot.B}es(t,s,i){I.drawImage(O,96,32,32,32,t.x-2*i,t.y-2*i,2*s,2*s)}ns(){return!!this.nt||this.ot.B.y>=this.size.y-1&&(this.nt=new f(3),this.os=v,!0)}J(){this.Jt.forEach((t=>t.J())),this.Yt.forEach((t=>t.J())),this.Kt.forEach((t=>t.J())),this.Ot.forEach((t=>t.forEach((t=>t.J()))))}lt(){if(I.imageSmoothingEnabled=!1,this.nt){Yt.et.rs(""),Yt.et.cs.hidden=!0,this.ot.Ht=!0;let t=this.step<10?this.nt.H():1,s=new l(.7,.8,.8,t).toString();I.fillStyle=s,I.fillRect(0,0,V.width,V.height),document.body.style.background=s,v=128*t+this.os*(1-t);const i=16*(v/32),h=.5*i,e=q(this.ot.B);I.font="600 19px monospace",I.fillStyle="#000",I.textAlign="center",I.textBaseline="bottom",this.nt.C()&&(this.step<10?(this.step=10,this.nt.set(2)):10==this.step?(this.step=11,this.nt.set(3)):11==this.step?(this.step=12,this.nt.set(4)):12==this.step?(this.step=13,this.nt.set(5)):13==this.step?(this.step=14,this.nt.set(.3)):14==this.step?(this.step=15,this.nt.set(.3)):15==this.step?(this.step=16,this.nt.set(1)):16==this.step?(this.step=17,this.nt.set(5)):D=!0),t=this.nt.H();const n=u(0,1);12==this.step?n.y=1-.5*t:this.step>12&&(n.y=.5);const o=q(this.ot.B.add(n));if(10==this.step)I.globalAlpha=t,this.es(o,i,h);else if(11==this.step)this.es(o,i,h),I.globalAlpha=1-t*t,I.fillText("You have done well, warrior.",o.x,o.y-76);else if(12==this.step)this.es(o,i,h),I.globalAlpha=1-t*t,I.fillText("Now it is my turn.",o.x,o.y-76);else if(13==this.step)this.es(o,i,h),I.globalAlpha=1-t*t,I.fillText("Fall a second time...",Math.round(o.x-8*t),o.y-100),I.fillText("...and ascend for the first.",Math.round(o.x+8*t),o.y-76);else if(14==this.step){const s=3*i;this.es(o,i,h),I.fillStyle="#f00",I.fillRect(e.x+32,e.y,-s*t,3)}else if(15==this.step){const s=3*i;this.es(o,i,h),I.fillStyle="#f00",I.fillRect(e.x+32-s*t,e.y,-s*(1-t),3)}else if(16==this.step)this.es(o,i,h);else if(17==this.step){this.es(o,i,h);const e=s;document.documentElement.style.background=e,s=new l(.1,.1,.1,t).toString(),I.fillStyle=s,I.fillRect(0,0,V.width,V.height),document.body.style.background=s,I.globalAlpha=t,I.font="600 128px monospace",I.fillStyle=e,I.fillText("Hel's Trial",V.width/2,V.height/2),I.globalAlpha=Math.sqrt(t),I.font="600 32px monospace",I.fillText("...is over",V.width/2,V.height/2+32)}this.step<17&&(I.globalAlpha=16==this.step?1-t:1,I.drawImage(O,0,32,16,16,e.x-h,e.y-h,i,i)),I.globalAlpha=1}else this.step<2&&!D&&I.drawImage(O,32,32,32,32,e(Math.round(.5*V.width-700),0),Math.round(.5*V.height),512,512);const t=new l(1,1,1,.02);G(u(7,13.25),u(1,2.5),t),G(u(7,13.5),u(1,2),t),G(u(7,13.75),u(1,1.5),t),G(u(7,14),u(1,1),t),G(u(7,14.25),u(1,.5),t)}update(){D||(0==this.step?Yt.et.us("h1","Hel, Ruler of Niflheim","Pitiful soul! Once proud warrior that unfortunately passed of old age and where thus cast into my Niflheim! Rejoice, for I give you a chance to die honorably and ascend into the ranks of Valhalla!",(()=>this.step=1)):1==this.step&&Yt.et.us("h2","Hel, Ruler of Niflheim","I have granted you a body and weapon, so that you may grow your soul power (SP) through the death of those you slay.<br><br>The trial begins! Fight your way out of my hall!",(()=>this.step=2))),this.step<2||D?D&&Yt.et.ls():super.update()}},Yt.ss=class extends F{constructor(t,s,i=-1){super(t,m,i,p,0,s),this.fs=!1,this.ds=!1,this.$=-1}F(){if(G(this.B,this.size,this.color),super.F(),this.fs)z(this.B,u(1),11,u(16));else if(this.ds){z(this.B,u(1),3,u(16));const t=Yt.X.ot;let s=Math.round(10*this.B.u(t.B))/10;t.kt-s<1&&(s=Math.ceil(s));const i=q(u(this.B.x,this.B.y));I.font="600 16px monospace",I.textAlign="center",I.textBaseline="middle",I.fillStyle="#0007",I.fillText(-s+" MV",i.x-1,i.y+1),I.fillStyle="#fff7",I.fillText(-s+" MV",i.x,i.y)}}update(){this.ds=!1,this.fs=!1,super.update()}},Yt.ht={ws:[],ps:0,gs:null,vs(){let t="";const s=Math.round(J.x),i=Math.round(J.y),h=Yt.X.Ot[s]?.[i];if(h&&Yt.et.ys){const e=Yt.it,n=u(s,i).u(e.B),o=Yt.X.Bt(u(s,i));let r=null;if(e.kt&&this.Ms(e,h,o))n<=e.kt&&(h.ds=!0,t="pointer",j(0)&&(this.gs=e.Et(s,i),e.kt-=Math.round(10*n)/10,e.kt<1&&(e.kt=0)));else if(e.Dt&&(r=this.bs(o))&&r!==e&&n<=e.St){let s=null;(s=this.xs(h,e,r))&&(t="pointer",j(0)&&(this.gs=e.Ft(s),e.Dt--))}}Yt.et.rs(t)},xs(t,s,i){let h=[i];const n=s.B.t();if(n.x=Math.round(n.x),n.y=Math.round(n.y),1==s.jt){const t=[u(n.x+1,n.y+1),u(n.x+1,n.y-1),u(n.x+1,n.y),u(n.x-1,n.y+1),u(n.x-1,n.y-1),u(n.x-1,n.y),u(n.x,n.y+1),u(n.x,n.y-1)];h[0].Ut=s.At,t.forEach((t=>{const i=Yt.X.Ot[t.x]?.[t.y];if(i){i.fs=!0;const e=Yt.X.Bt(t);if(e){const t=e.find((t=>t instanceof Yt.dt));t&&!h.includes(t)&&(t.Ut=s.At,h.push(t))}}}))}else if(2==s.jt){const i=[],o=t.B.i(s.B).normalize();let r=s.B.u(t.B);const c=t=>!(t instanceof Yt.dt||t instanceof Yt.qt);for(;r>=1;){const t=n.add(o.scale(r));t.x=Math.round(t.x),t.y=Math.round(t.y);const s=Yt.X.Ot[t.x]?.[t.y];if(!s)return null;{const e=Yt.X.Bt(t);if(e){if(e.find(c))return null;const t=e.find((t=>t instanceof Yt.dt));t&&!h.includes(t)&&h.push(t)}i.push(s)}r--}h.sort(((t,i)=>t.B.u(s.B)-i.B.u(s.B))),h.forEach(((t,i)=>{t.Ut=e(s.At-2*i,0)})),i.forEach((t=>t.fs=!0))}else h=i,i.Ut=s.At;return t.fs=!0,h},hs(t){this.ws.push(t)},bs:t=>t&&t.find((t=>t instanceof Yt.dt)),Ms(t,s,i){const h=t.B.i(s.B).normalize();let e=s.B.u(t.B);for(;e>=1;){const i=s.B.add(h.scale(e));if(i.x=Math.round(i.x),i.y=Math.round(i.y),(i.x!==t.B.x||i.y!==t.B.y)&&Yt.X.Bt(i))return!1;e--}return!i},Zt(){Yt.X.nt||(this.gs?this.gs((t=>this.As())):this.Ss()?this.vs():Yt.it&&(this.gs=Yt.it.Nt(),this.gs||(Yt.it.Dt=0,Yt.it.kt=0,this.As())))},As(){Yt.X.ts(),this.Ss()&&Yt.X.ns()||(this.gs=null,Yt.it.kt||Yt.it.Dt||(Yt.it.kt=Yt.it.bt,Yt.it.Dt=1,Yt.it=this.next()))},get(){return this.ws[this.ps]},Ss(){return this.get()===Yt.X.ot},next(){return++this.ps>=this.ws.length&&(this.ps=0),this.get()},It(t){for(let s=0;s<this.ws.length;s++){if(this.ws[s]===t){this.ws.splice(s,1),s<=this.ps&&this.ps--;break}}},reset(){this.ws=[],this.ps=0,this.gs=null}},Yt.et={ys:!1,Ts:new DOMParser,cs:null,Ps:{},ft(){const t=Yt.X.ot;t&&!D&&(I.font="600 16px monospace",I.textAlign="left",I.textBaseline="top",I.fillStyle="#000",I.fillText("SP "+t.rt.toFixed(0),15,29),I.fillStyle="#fff",I.fillText("SP "+t.rt.toFixed(0),16,28),I.fillStyle="#000",I.fillText("MV "+t.kt.toFixed(0),15,51),I.fillStyle="#fff",I.fillText("MV "+t.kt.toFixed(0),16,50),I.fillStyle="#000",I.fillText("(1) Direct Attack,   0 SP",15,95),I.fillStyle=0==t.jt?"#f00":"#fff",I.fillText("(1) Direct Attack,   0 SP",16,94),I.fillStyle="#000",I.fillText("(2) Sweeping Blow, -20 SP",15,117),I.fillStyle=1==t.jt?"#f00":"#fff",I.fillText("(2) Sweeping Blow, -20 SP",16,116),I.fillStyle="#000",I.fillText("(3) Throw Hatchet, -20 SP",15,139),I.fillStyle=2==t.jt?"#f00":"#fff",I.fillText("(3) Throw Hatchet, -20 SP",16,138),this.cs&&(this.cs.hidden=!Yt.ht.Ss())),D&&this.cs&&(this.cs.hidden=!0)},ls(){for(const t in this.Ps)this.Ps[t].style.display="none"},init(){document.onmouseover=t=>{this.ys="CANVAS"===t.target.tagName};const t=this.Ts.parseFromString('<button style="top:20px">End Turn</button>',"text/html").body.firstChild,s=this.Ts.parseFromString('<div class="b"><button style="top:0">(1) Direct Attack,   0 SP</button><button style="top:22px">(2) Sweeping Blow, -20 SP</button><button style="top:44px">(3) Throw Hatchet, -20 SP</button></div>',"text/html").body.firstChild;document.body.append(t,s),t.style.left=.5*(window.innerWidth-t.getBoundingClientRect().width)+"px",s.style.left=16+.5*(window.innerWidth-B.width)+"px",s.style.top=92+.5*(window.innerHeight-B.height)+"px",t.onclick=()=>{Yt.it.kt=0,Yt.it.Dt=0,Yt.ht.As()},s.querySelectorAll("button").forEach((t=>{t.onclick=s=>Yt.it.ut(Number(t.textContent.substring(1,2))-1)})),this.cs=t},rs(t){document.body.style.cursor=t},ct(){if(this.ks)return;const t=this.Ts.parseFromString('<div style="background:#000a;color:#c7e;font-size:32px;font-style:italic;font-weight:600;height:100vh;padding-top:45%;position:absolute;text-align:center;width:100%">With your body prematurely destroyed,<br>your soul’s home remains Niflheim.<br><br>END</div>',"text/html").body.firstChild;document.body.append(t),this.ks=t},us(t,s,i,e){let n=this.Ps[t];if(n)n.style.display="flex";else{const o=h(800,B.width),r=20+(window.innerHeight-B.height)/2,c=(window.innerWidth-o-20)/2;n=this.Ts.parseFromString(`<div style="background:#000c;border:4px solid #fff;bottom:${r}px;display:flex;flex-direction:column;left:${c}px;min-height:200px;padding:10px;position:absolute;width:${o}px"><div style="color:#c7e;font-style:italic;font-weight:600;margin:0 0 10px">${s}</div><div style="flex: 1 1">${i}</div><div class="n" style="background:#fff;color:#000;cursor:pointer;font-weight:600;margin:10px 0 0;padding:10px;text-align:center">Continue</div></div>`,"text/html").body.firstChild,document.body.append(n),n.querySelector(".n").onclick=s=>{n.remove(),delete this.Ps[t],e()},this.Ps[t]=n}}},Yt.Ds=class extends F{constructor(t){super(t?t.B:u(0),u(1)),this.At=1,this.St=1,this.name=null,this._s=t}F(){this._s&&super.F()}update(){this._s&&super.update()}};